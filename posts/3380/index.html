<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"code_unfold":{"enable":true,"CODE_MAX_HEIGHT":600},"path":"search.xml"};
  </script>

  <meta name="description" content="平时随笔写下的一些UE4和VR开发中的技术笔记，以及一些相关资料的收录，之前零零散散放在imzlp.com&#x2F;notes中，今天整理了一下，后续的笔记都会放到这篇文章中。">
<meta property="og:type" content="article">
<meta property="og:title" content="UE和VR开发技术笔记">
<meta property="og:url" content="https://imzlp.com/posts/3380/index.html">
<meta property="og:site_name" content="循迹研究室">
<meta property="og:description" content="平时随笔写下的一些UE4和VR开发中的技术笔记，以及一些相关资料的收录，之前零零散散放在imzlp.com&#x2F;notes中，今天整理了一下，后续的笔记都会放到这篇文章中。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230417215244.webp">
<meta property="article:published_time" content="2018-06-06T08:16:10.000Z">
<meta property="article:modified_time" content="2019-01-17T14:00:15.000Z">
<meta property="article:author" content="查利鹏">
<meta property="article:tag" content="UnrealEngine">
<meta property="article:tag" content="VR">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/20230417215244.webp">

<link rel="canonical" href="https://imzlp.com/posts/3380/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>UE和VR开发技术笔记 | 循迹研究室</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDCJ41EFP5"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FDCJ41EFP5');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="循迹研究室" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">循迹研究室</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>笔记</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>随笔</a>

  </li>


      
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>资源</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>友链</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>


      
        <li class="menu-item menu-item-showcase">

    <a href="/showcase/" rel="section"><i class="fa fa-solid fa-trophy fa-fw"></i>展示柜</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>站点日志</a>

  </li>
        <li class="menu-item menu-item-opensource">

    <a href="/opensource/" rel="section"><i class="fas fa-code-branch fa-fw"></i>开源项目</a>

  </li>
        <li class="menu-item menu-item-uewiki">

    <a href="https://ue5wiki.com/" rel="noopener" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>虚幻知识库</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>站内搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>



<script type="text/javascript">
  let domain='aW16bHAuY29t';
  let domain_str = atob(domain);
  let pathname = location.pathname;
  if (domain_str!= location.host.toLowerCase()){
        console.log(`this host is not safe,jump to https://${domain_str}${pathname}`);
        location.href=`https://${domain_str}${pathname}`;
  }
</script>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"
  >
    <link itemprop="mainEntityOfPage" href="https://imzlp.com/posts/3380/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
      <meta itemprop="name" content="查利鹏">
      <meta itemprop="description" content="唯有热爱可抵岁月漫长。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="循迹研究室">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE和VR开发技术笔记<a href="https://github.com/imzlp/blog-md/blob/master/_posts/2018-06-06-3380.md" class="post-edit-link" title="编辑" style="float: right;border-bottom: 0px;" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-06 08:16 08:16:10:16" itemprop="dateCreated datePublished" datetime="2018-06-06T08:16:10+00:00">2018-06-06 08:16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-17 14:00 14:00:15:00" itemprop="dateModified" datetime="2019-01-17T14:00:15+00:00">2019-01-17 14:00</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/" itemprop="url" rel="index"><span itemprop="name">UnrealEngine</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/UnrealEngine/VR/" itemprop="url" rel="index"><span itemprop="name">VR</span></a>
                </span>
            </span>

          
            <span id="/posts/3380/" class="post-meta-item leancloud_visitors" data-flag-title="UE和VR开发技术笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>39 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>平时随笔写下的一些UE4和VR开发中的技术笔记，以及一些相关资料的收录，之前零零散散放在<a href="https://imzlp.com/notes/">imzlp.com/notes</a>中，今天整理了一下，后续的笔记都会放到这篇文章中。</p>
<span id="more"></span>

<h2 id="Engine-Documents"><a href="#Engine-Documents" class="headerlink" title="Engine Documents"></a>Engine Documents</h2><h3 id="UE4-Online-Documents"><a href="#UE4-Online-Documents" class="headerlink" title="UE4 Online Documents"></a>UE4 Online Documents</h3><ul>
<li><a target="_blank" rel="noopener" href="http://api.unrealengine.com/INT/API/">Unreal Engine API Reference</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/Development/CodingStandard">Coding Standard</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/UnrealArchitecture/Reference">Unreal Architecture</a><ul>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/Modules/Gameplay/index.html">Gameplay Modules</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/Plugins/index.html">Plugins</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Classes/index.html">Gameplay Classes</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Classes/Specifiers/index.html">Class Specifiers</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Functions/index.html">Functions</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Functions/Specifiers/index.html">Function Specifiers</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Metadata/index.html">Metadata Specifiers</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Structs/index.html">Structs</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-origin.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Interfaces/index.html">Interfaces</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/Gameplay/Framework">Gameplay Framework</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/Development/CompilingProjects">Compiling Game Projects</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/Assets/AsyncLoading">Asynchronous Asset Loading</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/Online">Online Subsystem Overview</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Engine/Performance/StatCommands">Start Commands</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/Basics/CommandLineArguments">Command-Line Arguments</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.unrealengine.com/UPARAM">UPARAM</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.unrealengine.com/UPROPERTY">UPROPERTY</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.unrealengine.com/UFUNCTION">UFUNCTION</a></li>
</ul>
<h3 id="UE-GamePlay-Framework-Tutorial"><a href="#UE-GamePlay-Framework-Tutorial" class="headerlink" title="UE GamePlay Framework Tutorial"></a>UE GamePlay Framework Tutorial</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.tomlooman.com/ue4-gameplay-framework/">Unreal Engine Gameplay Framework Primer for C++</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/UnrealArchitecture/Reference/Classes">Gameplay Classes</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/UnrealArchitecture">Gameplay Programming</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/UnrealArchitecture/Actors/ActorLifecycle">Actor Lifecycle</a></li>
<li><a target="_blank" rel="noopener" href="https://habr.com/post/357976/">This post in Russian (Unofficial)</a></li>
</ul>
<h2 id="VR-Devices"><a href="#VR-Devices" class="headerlink" title="VR Devices"></a>VR Devices</h2><h3 id="UE适配不同VR设备的高度问题"><a href="#UE适配不同VR设备的高度问题" class="headerlink" title="UE适配不同VR设备的高度问题"></a>UE适配不同VR设备的高度问题</h3><p>在UE适配Oculus Rift和HTC Vive时注意把<code>TrackingOrigin</code>(<a target="_blank" rel="noopener" href="http://api.unrealengine.com/INT/API/Runtime/Engine/Kismet/EHMDTrackingOrigin__Type/index.html">EHMDTrackingOrigin::Type</a>)改为<code>Floor</code>，不然默认的追踪起源是在眼睛位置，导致头盔位置在游戏场景中高度不对。<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-Adaptive-OculusRift-And-Vive-Stracking-Origin-Setting.webp"></p>
<p>还有一个问题是，使用<code>PlayerStart</code>放置时，<code>PlayerStart</code>是有高度的，所以高度可能是不对的(取决于你的Pawn是怎么写的)，解决的办法是可以重写<code>AGameModeBase</code>的<code>SpawnDefaultPawnAtTransform</code>，来指定高度。</p>
<h3 id="UE中游戏启动VR头显初始化"><a href="#UE中游戏启动VR头显初始化" class="headerlink" title="UE中游戏启动VR头显初始化"></a>UE中游戏启动VR头显初始化</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/unreal-vr-glass-init.webp"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stereo On/Off</span><br><span class="line">Notice: Enables or Disables stereo rendering for Head Mounted Display (HMD) devices.</span><br></pre></td></tr></table></figure>

<h3 id="重置VR头显旋转和位置"><a href="#重置VR头显旋转和位置" class="headerlink" title="重置VR头显旋转和位置"></a>重置VR头显旋转和位置</h3><p>因为VR头显默认的朝向X轴是与房间设置的定位有关的，所以，当我们初始就与定位时的朝向偏离时，进入游戏就会偏离我们设定让玩家看到的东西，所以需要进行修正。<br>可以使用以下函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Resets orientation by setting roll and pitch to 0, assuming that current yaw is forward direction and assuming</span></span><br><span class="line"><span class="comment"> * current position as a &#x27;zero-point&#x27; (for positional tracking). </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param Yaw				(in) the desired yaw to be set after orientation reset.</span></span><br><span class="line"><span class="comment"> * @param Options			(in) specifies either position, orientation or both should be reset.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Input|HeadMountedDisplay&quot;</span>)</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">ResetOrientationAndPosition</span><span class="params">(<span class="type">float</span> Yaw = <span class="number">0.f</span>, EOrientPositionSelector::Type Options = EOrientPositionSelector::OrientationAndPosition)</span></span>;</span><br></pre></td></tr></table></figure>
<p>蓝图中也是同名的节点。</p>
<h3 id="在UE中使用Oculus-Rift"><a href="#在UE中使用Oculus-Rift" class="headerlink" title="在UE中使用Oculus Rift"></a>在UE中使用Oculus Rift</h3><p>在Oculus Rift设备安装完成之后需要在Oculus商店中启用<code>Unknow Source</code>，不然无法在UE中使用Oculus Rift预览。<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/oculus-rift-setting.webp"></p>
<p>Unreal的文档中适配Oculus Rift的页面：<a target="_blank" rel="noopener" href="https://docs.unrealengine.com/latest/INT/Platforms/Oculus/index.html">Developing for Oculus Rift</a>.</p>
<p>Oculus官方提供的按键操作介绍：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/Oculus-touch-controller-map.webp"></p>
<p>以及Oculus Rift在UE中的按键映射：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/oculus-rift-key-mapping-on-ue4.webp"></p>
<h3 id="HTC-Vive的按键映射"><a href="#HTC-Vive的按键映射" class="headerlink" title="HTC Vive的按键映射"></a>HTC Vive的按键映射</h3><p>与上面的Oculus Rift作为对比，附一张HTC Vive的按键映射：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/htc-vive-key-mapping-on-ue4.webp"></p>
<h3 id="HTC-VIVE设备设置"><a href="#HTC-VIVE设备设置" class="headerlink" title="HTC VIVE设备设置"></a>HTC VIVE设备设置</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/Vive-Setting-01.webp"><br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/Vive-Setting-02.webp"><br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/Vive-Setting-03.webp"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://support.steampowered.com/steamvr/HTC_Vive/">SteamVR Support - HTC Vive安装指南</a></li>
</ul>
<h3 id="SteamVR-2-0定位基站"><a href="#SteamVR-2-0定位基站" class="headerlink" title="SteamVR 2.0定位基站"></a>SteamVR 2.0定位基站</h3><p>HTC Vive Pro支持的定位器是SteamVR 2.0，支持150°和7米的追踪范围，而且支持基站串联(最多16个)实现大空间定位方案。<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/SteamVR/SteamVR2.0.webp"><br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/SteamVR/SteamVR2.0-station-channel-configuration.webp"></p>
<p>注意：二代基站不支持一代HTC Vive头显。</p>
<h3 id="使用Proxifier让Oculus走SS代理"><a href="#使用Proxifier让Oculus走SS代理" class="headerlink" title="使用Proxifier让Oculus走SS代理"></a>使用Proxifier让Oculus走SS代理</h3><p>昨天公司买了台Oculus Rift设备，在安装设备时需要全局代理，在Windows下我使用的是Proxifier来让Oculus相关软件走代理。<br>首先先添加Proxifier的代理：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/proxifier-add-proxy-serves.webp"><br>测试连接成功之后即可执行下列操作。</p>
<p>上面连接成功后可以添加一个代理规则，而Oculus程序相关的进程如下，我们需要做的是让下列的进程走SS的代理：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OculusSetup.exe;OculusClient.exe;OVRServiceLauncher.exe;OVRServer_x64.exe;OculusVR.exe;OculusCompatCheck.exe;CompatToolCommandLine.exe;OculusLogGatherer.exe;OVRLibrarian.exe;oculus-driver.exe;OVRLibraryService.exe;oculus-overlays.exe;OVRRedistributableInstaller.exe;</span><br></pre></td></tr></table></figure>
<p>将上面的内容填入<code>应用程序</code>文本框内之后，选择走SS的本地代理端口就可以了。<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/proxifier-ocukus-proxy-setting.webp"></p>
<p>其他的程序(如外服游戏、Steam等)，如果需要强制走SS代理也是同样的方法。</p>
<h3 id="VR画面模糊的问题"><a href="#VR画面模糊的问题" class="headerlink" title="VR画面模糊的问题"></a>VR画面模糊的问题</h3><p>因为UE项目中默认的<a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Resources/ContentExamples/PostProcessing/1_13">Screen Percentage</a>值是很低的，所以会感觉很模糊，但直接调高之后会有严重的帧率下降问题。<br>一般设置为200以内画面质量就不错了，下面列有UE的建议值(理想值)。然后需要美术在此基础上对场景进行优化，保证接近满帧的帧率。</p>
<p>在4.19之前(不含4.19)，VR HMD建议的理想值(<strong>r.ScreenPercentage</strong>)为：</p>
<table>
<thead>
<tr>
<th align="center">DeviceType</th>
<th align="center">r.ScreenPercentage</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Oculus Rift</td>
<td align="center">133</td>
</tr>
<tr>
<td align="center">HTC Vive</td>
<td align="center">140</td>
</tr>
<tr>
<td align="center">PSVR</td>
<td align="center">140</td>
</tr>
<tr>
<td align="center">GearVR</td>
<td align="center">120</td>
</tr>
<tr>
<td align="center">GoogleVR</td>
<td align="center">120</td>
</tr>
</tbody></table>
<p>在4.19之后UE增加了<code>vr.PixelDensity</code>，在<code>r.ScreenPercentage</code>保持为100时，就可以在不同平台的设备上使用标准化的值:</p>
<table>
<thead>
<tr>
<th align="center">DeviceType</th>
<th align="center">r.ScreenPercentage</th>
<th align="center">vr.PixelDensity</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Oculus Rift</td>
<td align="center">100</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">HTC Vive</td>
<td align="center">100</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">PSVR</td>
<td align="center">100</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">GearVR</td>
<td align="center">100</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">GoogleVR</td>
<td align="center">100</td>
<td align="center">1</td>
</tr>
</tbody></table>
<blockquote>
<p>Lower values will perform faster but will be undersampled (more blurry) while values over 1 will perform slower and will supersample (extra sharp).</p>
</blockquote>
<p>这样就可以通过控制<code>vr.PixelDensity</code>这个标准化的值来控制显示质量。<br>具体介绍链接：<a target="_blank" rel="noopener" href="https://www.unrealengine.com/en-US/blog/significant-changes-coming-to-vr-resolution-settings-in-4-19">Significant Changes Coming To VR Resolution Settings in 4.19</a></p>
<h3 id="HTC-VIVE定位器故障-03-的解决办法"><a href="#HTC-VIVE定位器故障-03-的解决办法" class="headerlink" title="HTC VIVE定位器故障(03)的解决办法"></a>HTC VIVE定位器故障(03)的解决办法</h3><p>如果定位器面板上闪红灯且SteamVR显示**定位器故障(03)**，请试着手动烧录定位器(基站)固件。步骤如下:<br>固件路径在Steam的安装路径下：<code>Steam\steamapps\common\SteamVR\tools\lighthouse\firmware\lighthouse_tx\archive\htc_2.0</code>，找到以下两个文件：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* lighthouse_tx_htc_2_0-calibration-rescue-244.bin</span><br><span class="line">* lighthouse_tx_htc_2_0-244-2016-03-12.bin</span><br></pre></td></tr></table></figure>
<ol>
<li>在定位器(基站)未通电情况下，将其通过micro-B USB传输线连接到电脑。</li>
<li>按住定位器(基站)背后的模式键并插入电源线.</li>
<li>一旦电脑端确认为USB大容量存储设备(USB mass storage device)，才可以释放模式键。</li>
<li>被连接的定位器(基站)储存设备名为“CRP_DISABLED”，打开后包含一个文件“firmware.bin”，删除它。</li>
<li>将“lighthouse_tx_htc_2_0-calibration-rescue-244.bin”文件复制到基站的储存空间上。</li>
<li>复制完成后，拔掉电源线。</li>
<li>等几秒，然后再次插上电源。在此过程中不要按模式键。几秒后定位器(基站)应该会快速的闪烁绿灯或者红灯。绿灯表示修复成功。</li>
<li>如果它闪烁红灯，这表示不能自动修复，请您送修。</li>
<li>再次拔下电源。</li>
<li>重复步骤1到7，但第5步复制文件改为“lighthouse_tx_htc_2_0-244-2016-03-12.bin”。</li>
<li>完整后定位器(基站)就恢复正常了，讲其频道设置为“A”并单独跟踪（另一个基站不通电）来确认运行情况。一旦确认工作正常，再打开另一个基站。</li>
</ol>
<p>如果出现闪烁绿灯无法正常使用，重复步骤1到7，但在第五步清除”CRP_DISABLED”中所有文件，只复制 “lighthouse_tx_htc_2_0-244-2016-03-12.bin” 即可。</p>
<ul>
<li>如果手动烧录定位器(基站)固件和校准文还是无效，请使用手机拍照确定下列两个雷射点是否正常（不能用iphone/ipad雷射点拍不出來），如果这两个雷射点任一个没有显示，代表雷射损坏，请送客服检查。</li>
</ul>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/using-burn-bin-fix-htc-vive-red-light-flicker.webp"><br>参考链接：<a target="_blank" rel="noopener" href="https://www.vive.com/cn/forum/2632">定位器故障(03)</a></p>
<h2 id="Engine-Analysis"><a href="#Engine-Analysis" class="headerlink" title="Engine Analysis"></a>Engine Analysis</h2><h3 id="UE-Game的启动"><a href="#UE-Game的启动" class="headerlink" title="UE Game的启动"></a>UE Game的启动</h3><p>游戏的初始化是从<code>UGameInstance::StartGameInstance</code>开始的。<br>通过<code>FEngineLoop::Init()</code>中调用<code>GEngine-&gt;Start()</code>多态调用到<code>UGameEngine::Start()</code>中调用<code>GameInstance-&gt;StartGameInstance();</code>：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-GameStart-GameInit-StartGameInstance.webp"></p>
<h3 id="UE中Actor初始化"><a href="#UE中Actor初始化" class="headerlink" title="UE中Actor初始化"></a>UE中Actor初始化</h3><p>AActor的<code>PreInitializeComponents</code>/<code>InitializeComponents</code>/<code>PostInitializeComponents</code>以及<code>DispatchBeginPlay</code>均在<a target="_blank" rel="noopener" href="http://api.unrealengine.com/INT/API/Runtime/Engine/Engine/ULevel/RouteActorInitialize/index.html">ULevel::RouteActorInitialize</a>中调用。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ULevel::RouteActorInitialize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Send PreInitializeComponents and collect volumes.</span></span><br><span class="line">  <span class="keyword">for</span>( int32 Index = <span class="number">0</span>; Index &lt; Actors.<span class="built_in">Num</span>(); ++Index )</span><br><span class="line">  &#123;</span><br><span class="line">    AActor* <span class="type">const</span> Actor = Actors[Index];</span><br><span class="line">    <span class="keyword">if</span>( Actor &amp;&amp; !Actor-&gt;<span class="built_in">IsActorInitialized</span>() )</span><br><span class="line">    &#123;</span><br><span class="line">      Actor-&gt;<span class="built_in">PreInitializeComponents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">bool</span> bCallBeginPlay = OwningWorld-&gt;<span class="built_in">HasBegunPlay</span>();</span><br><span class="line">  TArray&lt;AActor *&gt; ActorsToBeginPlay;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Send InitializeComponents on components and PostInitializeComponents.</span></span><br><span class="line">  <span class="keyword">for</span>( int32 Index = <span class="number">0</span>; Index &lt; Actors.<span class="built_in">Num</span>(); ++Index )</span><br><span class="line">  &#123;</span><br><span class="line">    AActor* <span class="type">const</span> Actor = Actors[Index];</span><br><span class="line">    <span class="keyword">if</span>( Actor )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>( !Actor-&gt;<span class="built_in">IsActorInitialized</span>() )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// Call Initialize on Components.</span></span><br><span class="line">        Actor-&gt;<span class="built_in">InitializeComponents</span>();</span><br><span class="line"></span><br><span class="line">        Actor-&gt;<span class="built_in">PostInitializeComponents</span>(); <span class="comment">// should set Actor-&gt;bActorInitialized = true</span></span><br><span class="line">        <span class="keyword">if</span> (!Actor-&gt;<span class="built_in">IsActorInitialized</span>() &amp;&amp; !Actor-&gt;<span class="built_in">IsPendingKill</span>())</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">UE_LOG</span>(LogActor, Fatal, <span class="built_in">TEXT</span>(<span class="string">&quot;%s failed to route PostInitializeComponents.  Please call Super::PostInitializeComponents() in your &lt;className&gt;::PostInitializeComponents() function. &quot;</span>), *Actor-&gt;<span class="built_in">GetFullName</span>() );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bCallBeginPlay &amp;&amp; !Actor-&gt;<span class="built_in">IsChildActor</span>())</span><br><span class="line">        &#123;</span><br><span class="line">          ActorsToBeginPlay.<span class="built_in">Add</span>(Actor);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Components are all set up, init touching state.</span></span><br><span class="line">      <span class="comment">// Note: Not doing notifies here since loading or streaming in isn&#x27;t actually conceptually beginning a touch.</span></span><br><span class="line">      <span class="comment">//       Rather, it was always touching and the mechanics of loading is just an implementation detail.</span></span><br><span class="line">      Actor-&gt;<span class="built_in">UpdateOverlaps</span>(Actor-&gt;bGenerateOverlapEventsDuringLevelStreaming);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Do this in a second pass to make sure they&#x27;re all initialized before begin play starts</span></span><br><span class="line">  <span class="keyword">for</span> (int32 ActorIndex = <span class="number">0</span>; ActorIndex &lt; ActorsToBeginPlay.<span class="built_in">Num</span>(); ActorIndex++)</span><br><span class="line">  &#123;</span><br><span class="line">    AActor* Actor = ActorsToBeginPlay[ActorIndex];</span><br><span class="line">    <span class="built_in">SCOPE_CYCLE_COUNTER</span>(STAT_ActorBeginPlay);</span><br><span class="line">    Actor-&gt;<span class="built_in">DispatchBeginPlay</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="UE4-Engine-Start-Order"><a href="#UE4-Engine-Start-Order" class="headerlink" title="UE4:Engine Start Order"></a>UE4:Engine Start Order</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UnrealEngineStartOrder.webp"></p>
<h3 id="UE引擎的Tick调用栈-call-stack"><a href="#UE引擎的Tick调用栈-call-stack" class="headerlink" title="UE引擎的Tick调用栈(call stack)"></a>UE引擎的Tick调用栈(call stack)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">FEngineLoop_Tick=&gt;start: void FEngineLoop::Tick()</span><br><span class="line">UGameEngine_Tick=&gt;operation: void UGameEngine::Tick( float DeltaSeconds, bool bIdleMode )</span><br><span class="line">UWorld_Tick=&gt;operation: void UWorld::Tick( ELevelTick TickType, float DeltaSeconds)</span><br><span class="line">UWorld_RunTickGroup=&gt;operation: void UWorld::RunTickGroup(ETickingGroup Group, bool bBlockTillComplete = true)</span><br><span class="line">FTickTaskManager_RunTickGroup=&gt;operation: void FTickTaskManager::RunTickGroup(ETickingGroup Group, bool bBlockTillComplete )</span><br><span class="line">FTickTaskSequencer_ReleaseTickGroup=&gt;operation: void FTickTaskSequencer::ReleaseTickGroup(ETickingGroup WorldTickGroup, bool bBlockTillComplete)</span><br><span class="line">FTaskGraphImplementation_WaitUntilTaskComplete=&gt;operation: FTaskGraphImplementation::WaitUntilTaskComplete()</span><br><span class="line">FNamedTaskThread_ProcessTaskUntilQuit=&gt;operation: FNamedTaskThread::ProcessTaskUntilQuit()</span><br><span class="line">FNameTaskThread_ProcessTaskNamedThread=&gt;operation: FNameTaskThread::ProcessTaskNamedThread()</span><br><span class="line">FTaskGraphInterfaces_ExecuteTask=&gt;operation: FTaskGraphInterfaces::ExecuteTask()</span><br><span class="line">FTickFunction_DoTask=&gt;operation: FTickFunction::DoTask()</span><br><span class="line">DynamicExecFTickFunctionExecuteTick=&gt;condition: Polymorphism execute FTickFunction::ExecuteTask()</span><br><span class="line">AActor_Tick=&gt;subroutine: AActor</span><br><span class="line">AActor_Tick_FActorTickFunction_ExecuteTick=&gt;operation: FActorTickFunction::ExecuteTick()</span><br><span class="line">AActor_Tick_AActor_TickActor=&gt;operation: AActor::TickActor()</span><br><span class="line">AActor_Tick_AActor_Tick=&gt;operation: AActor::Tick()</span><br><span class="line">AActor_Tick_AActor_ReceiveTick=&gt;operation: AActor::ReceiveTick() // BpTick</span><br><span class="line"></span><br><span class="line">ActorComponent_Tick=&gt;subroutine: ActorComponent</span><br><span class="line">ActorComponent_Tick_FActorComponentTickFunction_ExecuteTick=&gt;operation: FActorComponentTickFunction::ExecuteTick()</span><br><span class="line">ActorComponent_Tick_FActorComponentTickFunction_ExecuteTickHelper=&gt;operation: FActorComponentTickFunction::ExecuteTickHelper()</span><br><span class="line">ActorComponent_Tick_UActorComponent_TickComponent=&gt;operation: UActorComponent::TickComponent()</span><br><span class="line">ActorComponent_Tick_ReceiveTick=&gt;operation: UActorComponent::ReceiveTick(DeltaTime) // BpTick</span><br><span class="line">end=&gt;end: End</span><br><span class="line"></span><br><span class="line">FEngineLoop_Tick-&gt;UGameEngine_Tick</span><br><span class="line">UGameEngine_Tick-&gt;UWorld_Tick</span><br><span class="line">UWorld_Tick-&gt;UWorld_RunTickGroup</span><br><span class="line">UWorld_RunTickGroup-&gt;FTickTaskManager_RunTickGroup</span><br><span class="line">FTickTaskManager_RunTickGroup-&gt;FTickTaskSequencer_ReleaseTickGroup</span><br><span class="line">FTickTaskSequencer_ReleaseTickGroup-&gt;FTaskGraphImplementation_WaitUntilTaskComplete</span><br><span class="line">FTaskGraphImplementation_WaitUntilTaskComplete-&gt;FNamedTaskThread_ProcessTaskUntilQuit</span><br><span class="line">FNamedTaskThread_ProcessTaskUntilQuit-&gt;FNameTaskThread_ProcessTaskNamedThread</span><br><span class="line">FNameTaskThread_ProcessTaskNamedThread-&gt;FTaskGraphInterfaces_ExecuteTask</span><br><span class="line">FTaskGraphInterfaces_ExecuteTask-&gt;FTickFunction_DoTask</span><br><span class="line">FTickFunction_DoTask-&gt;DynamicExecFTickFunctionExecuteTick</span><br><span class="line">DynamicExecFTickFunctionExecuteTick(yes,left)-&gt;AActor_Tick</span><br><span class="line">AActor_Tick-&gt;AActor_Tick_FActorTickFunction_ExecuteTick</span><br><span class="line">AActor_Tick_FActorTickFunction_ExecuteTick-&gt;AActor_Tick_AActor_TickActor</span><br><span class="line">AActor_Tick_AActor_TickActor-&gt;AActor_Tick_AActor_Tick</span><br><span class="line">AActor_Tick_AActor_Tick-&gt;AActor_Tick_AActor_ReceiveTick</span><br><span class="line">AActor_Tick_AActor_ReceiveTick-&gt;end</span><br><span class="line">DynamicExecFTickFunctionExecuteTick(no,right)-&gt;ActorComponent_Tick</span><br><span class="line">ActorComponent_Tick-&gt;ActorComponent_Tick_FActorComponentTickFunction_ExecuteTick</span><br><span class="line">ActorComponent_Tick_FActorComponentTickFunction_ExecuteTick-&gt;ActorComponent_Tick_FActorComponentTickFunction_ExecuteTickHelper</span><br><span class="line">ActorComponent_Tick_FActorComponentTickFunction_ExecuteTickHelper-&gt;ActorComponent_Tick_UActorComponent_TickComponent</span><br><span class="line">ActorComponent_Tick_UActorComponent_TickComponent-&gt;ActorComponent_Tick_ReceiveTick</span><br><span class="line">ActorComponent_Tick_ReceiveTick-&gt;end</span><br></pre></td></tr></table></figure>
<h3 id="Game-Flow-on-UE4"><a href="#Game-Flow-on-UE4" class="headerlink" title="Game Flow on UE4"></a>Game Flow on UE4</h3><p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/Gameplay/Framework/GameFlow">Game Flow Overview on UE4</a></p>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/GameFlowChart.webp"></p>
<h3 id="Actor-LifeCycle"><a href="#Actor-LifeCycle" class="headerlink" title="Actor LifeCycle"></a>Actor LifeCycle</h3><p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/UnrealArchitecture/Actors/ActorLifecycle">Actor Lifecycle on Unreal Engine</a><br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/ActorLifeCycle.webp"></p>
<h3 id="UE-Log-macro-defined"><a href="#UE-Log-macro-defined" class="headerlink" title="UE Log macro defined"></a>UE Log macro defined</h3><p>UE源码中的一些Log定义：<br><a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Source/Runtime/Engine/Public/EngineLogs.h">EngineLogs.h</a>中定义了这些Log:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogPath, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogPhysics, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogBlueprint, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogBlueprintUserMessages, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogAnimation, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogRootMotion, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogLevel, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogSkeletalMesh, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogStaticMesh, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogNet, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogRep, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogNetPlayerMovement, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogNetTraffic, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogRepTraffic, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogNetFastTArray, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogNetDormancy, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogSkeletalControl, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogSubtitle, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogTexture, Log, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogPlayerManagement, Error, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogSecurity, Warning, All)</span></span>;</span><br><span class="line"><span class="function">ENGINE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogEngineSessionManager, Log, All)</span></span>;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Source/Runtime/Core/Public/CoreGlobals.h">CoreGlobals.h</a>中定义了下面这些Log:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogHAL, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogMac, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogLinux, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogIOS, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogAndroid, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogPS4, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogXboxOne, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogWindows, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogSwitch, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogQuail, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogSerialization, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogUnrealMath, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogUnrealMatrix, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogContentComparisonCommandlet, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogNetPackageMap, Warning, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogNetSerialization, Warning, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogMemory, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogProfilingDebugging, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogCore, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogOutputDevice, Log, All)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogSHA, Warning, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogStats, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogStreaming, Display, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogInit, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogExit, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogExec, Warning, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogScript, Warning, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogLocalization, Error, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogLongPackageNames, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogProcess, Log, All)</span></span>;</span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogLoad, Log, All)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Temporary log category, generally you should not check things in that use this</span></span><br><span class="line"><span class="function">CORE_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogTemp, Log, All)</span></span>;</span><br></pre></td></tr></table></figure>
<p>最近用到的一些Log定义地方一并贴出：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Module: Json</span></span><br><span class="line"><span class="comment">// File: Runtime/Json/Public/JsonGlobals.h</span></span><br><span class="line"><span class="function">JSON_API <span class="title">DECLARE_LOG_CATEGORY_EXTERN</span><span class="params">(LogJson, Log, All)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="检测是否为安装版引擎的方法"><a href="#检测是否为安装版引擎的方法" class="headerlink" title="检测是否为安装版引擎的方法"></a>检测是否为安装版引擎的方法</h3><p>在EpicGameLauncher安装的引擎版本是不能通过<code>UnrealBuildTool.exe -ProjectFiles &quot;ProgramProjectName&quot;</code>来创建Target<code>Program</code>的项目的，会提示下列错误：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: UnrealBuildTool Exception: A game project path was not specified, which is required when generating project files using an installed build or passing -game on the command line</span><br></pre></td></tr></table></figure>
<p>这个异常在UBT里的相关代码在<code>ProjectFileGenreator.cs</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ProjectFileGenreator.cs</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">ConfigureProjectFileGeneration</span>(<span class="params"> String[] Arguments, <span class="keyword">ref</span> <span class="built_in">bool</span> IncludeAllPlatforms </span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">switch</span>( CurArgument.ToUpperInvariant() )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="keyword">case</span> <span class="string">&quot;-GAME&quot;</span>:</span><br><span class="line">			<span class="comment">// Generates project files for a single game</span></span><br><span class="line">			bGeneratingGameProjectFiles = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( bGeneratingGameProjectFiles || UnrealBuildTool.IsEngineInstalled() )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (OnlyGameProject == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BuildException(<span class="string">&quot;A game project path was not specified, which is required when generating project files using an installed build or passing -game on the command line&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		GameProjectName = OnlyGameProject.GetFileNameWithoutExtension();</span><br><span class="line">		<span class="keyword">if</span> (String.IsNullOrEmpty(GameProjectName))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BuildException(<span class="string">&quot;A valid game project was not found in the specified location (&quot;</span> + OnlyGameProject.Directory.FullName + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">bool</span> bInstalledEngineWithSource = UnrealBuildTool.IsEngineInstalled() &amp;&amp; DirectoryReference.Exists(UnrealBuildTool.EngineSourceDirectory);</span><br><span class="line"></span><br><span class="line">		bIncludeEngineSource = bAlwaysIncludeEngineModules || bInstalledEngineWithSource;</span><br><span class="line">		bIncludeDocumentation = <span class="literal">false</span>;</span><br><span class="line">		bIncludeBuildSystemFiles = <span class="literal">false</span>;</span><br><span class="line">		bIncludeShaderSource = <span class="literal">true</span>;</span><br><span class="line">		bIncludeTemplateFiles = <span class="literal">false</span>;</span><br><span class="line">		bIncludeConfigFiles = <span class="literal">true</span>;</span><br><span class="line">		IncludeEnginePrograms = bAlwaysIncludeEngineModules;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，<code>if</code>这里如果传递给UBT<code>-game</code>参数并且是引擎是安装版本(EpicGameLauncher)时会检测有没有传入<code>project</code>参数，如果没有就会抛异常。<br>正常的UBT调用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnrelBuildTool.exe -ProjectFiles -project=&quot;D:\UnrealProjects\UEProject.uproject&quot; -game</span><br></pre></td></tr></table></figure>
<p>这种普通的Game参数在UBT里面是不会抛异常的。但是用生成Program的命令来调用UBT，安装版引擎就会抛异常：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnrelBuildTool.exe -ProjectFiles ProgramName</span><br></pre></td></tr></table></figure>
<p>根据上面<code>ProjectFileGenreator.cs</code>的检测代码，我们要做到的是把<code>UnrealBuildTool.IsEngineInstalled()</code>获取的结果变为false.<br>继续跟代码：<code>UnrealBuildTool.IsEngineInstalled()</code>获得的是<code>UnrealBuildTool</code>中的一个bool变量<code>bIsEngineInstalled</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UnrealBuildTool.cs</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsEngineInstalled</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (!bIsEngineInstalled.HasValue)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> BuildException(<span class="string">&quot;IsEngineInstalled() called before being initialized.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> bIsEngineInstalled.Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查找引用发现在<code>GuardedMain</code>里有设置<code>bIsEngineInstalled</code>这个变量的地方：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UnrealBuildTool.cs</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">GuardedMain</span>(<span class="params"><span class="built_in">string</span>[] Arguments</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="keyword">foreach</span> (<span class="built_in">string</span> Argument <span class="keyword">in</span> Arguments)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">string</span> LowercaseArg = Argument.ToLowerInvariant();</span><br><span class="line">			<span class="keyword">if</span> (LowercaseArg == <span class="string">&quot;-installed&quot;</span> || LowercaseArg == <span class="string">&quot;-installedengine&quot;</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				bIsEngineInstalled = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (LowercaseArg == <span class="string">&quot;-notinstalledengine&quot;</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				bIsEngineInstalled = <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!bIsEngineInstalled.HasValue)</span><br><span class="line">		&#123;</span><br><span class="line">			bIsEngineInstalled = FileReference.Exists(FileReference.Combine(RootDirectory, <span class="string">&quot;Engine&quot;</span>, <span class="string">&quot;Build&quot;</span>, <span class="string">&quot;InstalledBuild.txt&quot;</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从代码可以看到，UBT对是不是安装版引擎的检测有三种方法：</p>
<ol>
<li>传入参数是否有<code>-installled</code>和<code>-installedengine</code></li>
<li>传入参数是否有<code>-notinstallengine</code></li>
<li>判断引擎路径<code>Engine\Build</code>下是否具有<code>InstalledBuild.txt</code>文件</li>
</ol>
<p>(说是三种其实也就是两种，就算指定了<code>-notinstallengine</code>也是要判断存不存在<code>Engine\Build\InstalledBuild.txt</code>这个文件)<br>而且检测的顺序是这样的:</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-installled &gt; -installedengine &gt; -notinstalledengine &gt; Engine\Build\InstalledBuild.txt</span><br></pre></td></tr></table></figure>
<p>所以，当我想要让UBT认为我的引擎版本不是安装版，有两种办法：</p>
<ol>
<li>对UBT的调用传入<code>-notinstalledengine</code>参数，并且删掉<code>Engine\Build</code>目录下的<code>InstalledBuild.txt</code>文件</li>
<li>对UBT的调用不传入<code>-installled</code>和<code>-installedengine</code>参数，并且删掉<code>Engine\Build</code>目录下的<code>InstalledBuild.txt</code>文件</li>
</ol>
<p><strong>注</strong>：UBT里还有下面两种检测：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UnrealBuildTools.cs</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsEnterpriseInstalled</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(!bIsEnterpriseInstalled.HasValue)</span><br><span class="line">	&#123;</span><br><span class="line">		bIsEnterpriseInstalled = FileReference.Exists(FileReference.Combine(EnterpriseDirectory, <span class="string">&quot;Build&quot;</span>, <span class="string">&quot;InstalledBuild.txt&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> bIsEnterpriseInstalled.Value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsProjectInstalled</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (!bIsProjectInstalled.HasValue)</span><br><span class="line">	&#123;</span><br><span class="line">		bIsProjectInstalled = FileReference.Exists(FileReference.Combine(RootDirectory, <span class="string">&quot;Engine&quot;</span>, <span class="string">&quot;Build&quot;</span>, <span class="string">&quot;InstalledProjectBuild.txt&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> bIsProjectInstalled.Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UE-Get-all-registed-Engine"><a href="#UE-Get-all-registed-Engine" class="headerlink" title="UE:Get all registed Engine"></a>UE:Get all registed Engine</h3><p>可以使用<code>IDesktopPlatform::EnumerateEngineInstallations</code>来获取当前系统中所有从启动器安装、以及用户使用<code>UnrealVersionSelector</code>注册的引擎版本。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TMap&lt;FString,FString&gt; Installations;</span><br><span class="line">FDesktopPlatformModule::<span class="built_in">Get</span>()-&gt;<span class="built_in">EnumerateEngineInstallations</span>(Installations)</span><br></pre></td></tr></table></figure>

<h3 id="UnrealVersionSelector注册引擎路径"><a href="#UnrealVersionSelector注册引擎路径" class="headerlink" title="UnrealVersionSelector注册引擎路径"></a>UnrealVersionSelector注册引擎路径</h3><p>使用UnrealVersionSelector注册引擎时，会将注册的引擎路径写入到注册表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\SOFTWARE\Epic Games\Unreal Engine\Builds</span><br></pre></td></tr></table></figure>
<p>其注册表项的<code>lpValueName</code>则是生成的一个GUID：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DesktopPlatfromWindows.cpp</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">FDesktopPlatformWindows::RegisterEngineInstallation</span><span class="params">(<span class="type">const</span> FString &amp;RootDir, FString &amp;OutIdentifier)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">bool</span> bRes = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">IsValidRootDirectory</span>(RootDir))</span><br><span class="line">  &#123;</span><br><span class="line">    HKEY hRootKey;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">RegCreateKeyEx</span>(HKEY_CURRENT_USER, InstallationsSubKey, <span class="number">0</span>, <span class="literal">NULL</span>, REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, <span class="literal">NULL</span>, &amp;hRootKey, <span class="literal">NULL</span>) == ERROR_SUCCESS)</span><br><span class="line">    &#123;</span><br><span class="line">      FString NewIdentifier = FGuid::<span class="built_in">NewGuid</span>().<span class="built_in">ToString</span>(EGuidFormats::DigitsWithHyphensInBraces);</span><br><span class="line">      LRESULT SetResult = <span class="built_in">RegSetValueEx</span>(hRootKey, *NewIdentifier, <span class="number">0</span>, REG_SZ, (<span class="type">const</span> BYTE*)*RootDir, (RootDir.<span class="built_in">Len</span>() + <span class="number">1</span>) * <span class="built_in">sizeof</span>(TCHAR));</span><br><span class="line">      <span class="built_in">RegCloseKey</span>(hRootKey);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(SetResult == ERROR_SUCCESS)</span><br><span class="line">      &#123;</span><br><span class="line">        OutIdentifier = NewIdentifier;</span><br><span class="line">        bRes = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> bRes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UE并没有直接在<code>IDesktopPlatfrom</code>中<strong>单独提供</strong>获取用户通过使用UnrealVersionSelector注册的引擎列表。<br>但是在<code>EnumerateEngineInstallations</code>中写了从注册表获取<code>per-user installations</code>引擎：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FDesktopPlatformWindows::EnumerateEngineInstallations</span><span class="params">(TMap&lt;FString, FString&gt; &amp;OutInstallations)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Enumerate the binary installations</span></span><br><span class="line">  <span class="built_in">EnumerateLauncherEngineInstallations</span>(OutInstallations);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Enumerate the per-user installations</span></span><br><span class="line">  HKEY hKey;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">RegOpenKeyEx</span>(HKEY_CURRENT_USER, InstallationsSubKey, <span class="number">0</span>, KEY_ALL_ACCESS, &amp;hKey) == ERROR_SUCCESS)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Get a list of all the directories</span></span><br><span class="line">    TArray&lt;FString&gt; UniqueDirectories;</span><br><span class="line">    OutInstallations.<span class="built_in">GenerateValueArray</span>(UniqueDirectories);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Enumerate all the installations</span></span><br><span class="line">    TArray&lt;FString&gt; InvalidKeys;</span><br><span class="line">    <span class="keyword">for</span> (::DWORD Index = <span class="number">0</span>;; Index++)</span><br><span class="line">    &#123;</span><br><span class="line">      TCHAR ValueName[<span class="number">256</span>];</span><br><span class="line">      TCHAR ValueData[MAX_PATH];</span><br><span class="line">      ::DWORD ValueType = <span class="number">0</span>;</span><br><span class="line">      ::DWORD ValueNameLength = <span class="built_in">sizeof</span>(ValueName) / <span class="built_in">sizeof</span>(ValueName[<span class="number">0</span>]);</span><br><span class="line">      ::DWORD ValueDataSize = <span class="built_in">sizeof</span>(ValueData);</span><br><span class="line"></span><br><span class="line">      LRESULT Result = <span class="built_in">RegEnumValue</span>(hKey, Index, ValueName, &amp;ValueNameLength, <span class="literal">NULL</span>, &amp;ValueType, (BYTE*)&amp;ValueData[<span class="number">0</span>], &amp;ValueDataSize);</span><br><span class="line">      <span class="keyword">if</span>(Result == ERROR_SUCCESS)</span><br><span class="line">      &#123;</span><br><span class="line">        int32 ValueDataLength = ValueDataSize / <span class="built_in">sizeof</span>(TCHAR);</span><br><span class="line">        <span class="keyword">if</span>(ValueDataLength &gt; <span class="number">0</span> &amp;&amp; ValueData[ValueDataLength - <span class="number">1</span>] == <span class="number">0</span>) ValueDataLength--;</span><br><span class="line"></span><br><span class="line">        <span class="function">FString <span class="title">NormalizedInstalledDirectory</span><span class="params">(ValueDataLength, ValueData)</span></span>;</span><br><span class="line">        FPaths::<span class="built_in">NormalizeDirectoryName</span>(NormalizedInstalledDirectory);</span><br><span class="line">        FPaths::<span class="built_in">CollapseRelativeDirectories</span>(NormalizedInstalledDirectory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">IsValidRootDirectory</span>(NormalizedInstalledDirectory) &amp;&amp; !UniqueDirectories.<span class="built_in">Contains</span>(NormalizedInstalledDirectory))</span><br><span class="line">        &#123;</span><br><span class="line">          OutInstallations.<span class="built_in">Add</span>(ValueName, NormalizedInstalledDirectory);</span><br><span class="line">          UniqueDirectories.<span class="built_in">Add</span>(NormalizedInstalledDirectory);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          InvalidKeys.<span class="built_in">Add</span>(ValueName);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(Result == ERROR_NO_MORE_ITEMS)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove all the keys which weren&#x27;t valid</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">const</span> FString InvalidKey: InvalidKeys)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">RegDeleteValue</span>(hKey, *InvalidKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RegCloseKey</span>(hKey);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EpicGameLauncher版引擎注册表路径"><a href="#EpicGameLauncher版引擎注册表路径" class="headerlink" title="EpicGameLauncher版引擎注册表路径"></a>EpicGameLauncher版引擎注册表路径</h3><p>上面提到，如果非源码版引擎，使用UnrealVersionSelector注册时会写入到注册表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\SOFTWARE\Epic Games\Unreal Engine\Builds</span><br></pre></td></tr></table></figure>
<p>从EpicGameLauncher安装的版本则会写入到另一个注册表路径下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\EpicGames\Unreal Engine</span><br></pre></td></tr></table></figure>
<p>其值为(从注册表导出的)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\EpicGames\Unreal Engine\4.18]</span><br><span class="line">&quot;InstalledDirectory&quot;=&quot;C:\\Program Files\\Epic Games\\UE_4.18&quot;</span><br></pre></td></tr></table></figure>

<p>UE提供了方法来得到从EpicGameLauncher安装的引擎(通过<code>IDesktopPlatfrom</code>接口)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TMap&lt;FString,FString&gt; Installations;</span><br><span class="line">FDesktopPlatformModule::<span class="built_in">Get</span>()-&gt;<span class="built_in">EnumerateLauncherEngineInstallations</span>(OutInstallations);</span><br></pre></td></tr></table></figure>

<h3 id="UnrealVersionSelector的注册表文件关联"><a href="#UnrealVersionSelector的注册表文件关联" class="headerlink" title="UnrealVersionSelector的注册表文件关联"></a>UnrealVersionSelector的注册表文件关联</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\.uproject]</span><br><span class="line">@=&quot;Unreal.ProjectFile&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile]</span><br><span class="line">@=&quot;Unreal Engine Project File&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\DefaultIcon]</span><br><span class="line">@=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell]</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\open]</span><br><span class="line">@=&quot;Open&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\open\command]</span><br><span class="line">@=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot; /editor \&quot;%1\&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\run]</span><br><span class="line">@=&quot;Launch game&quot;</span><br><span class="line">&quot;Icon&quot;=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\run\command]</span><br><span class="line">@=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot; /game \&quot;%1\&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\rungenproj]</span><br><span class="line">@=&quot;Generate Visual Studio project files&quot;</span><br><span class="line">&quot;Icon&quot;=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\rungenproj\command]</span><br><span class="line">@=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot; /projectfiles \&quot;%1\&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\switchversion]</span><br><span class="line">@=&quot;Switch Unreal Engine version...&quot;</span><br><span class="line">&quot;Icon&quot;=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot;&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Unreal.ProjectFile\shell\switchversion\command]</span><br><span class="line">@=&quot;\&quot;C:\\Program Files (x86)\\Epic Games\\Launcher\\Engine\\Binaries\\Win64\\UnrealVersionSelector.exe\&quot; /switchversion \&quot;%1\&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>注：如果想要为自己定义的文件加上启动方式，也可以使用这种方式。</p>
<h3 id="UE注册编译版引擎的安装路径"><a href="#UE注册编译版引擎的安装路径" class="headerlink" title="UE注册编译版引擎的安装路径"></a>UE注册编译版引擎的安装路径</h3><p>UE提供了<code>UnrealVersionSelector</code>工具用来选择引擎版本/生成sln等功能，其也可以用来注册本地的引擎(非Launcher安装的引擎，如自己编译的源码版引擎)到项目文件的右键<code>Select Unreal Engine Version...</code>列表中。<br>简单分析了一下<code>UnrealVersionSelector</code>的代码，它的注册流程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">WinMain_Func=&gt;start: WinMain</span><br><span class="line">Main_Func=&gt;operation: Main(Arguments)</span><br><span class="line">RegisterCurrentEngineDirectoryWithPrompt_Func=&gt;operation: RegisterCurrentEngineDirectoryWithPrompt()</span><br><span class="line">RegisterCurrentEngineDirectory_Func=&gt;operation: RegisterCurrentEngineDirectory(false)</span><br><span class="line">GetEngineIdentifierFromRootDir_Func=&gt;operation: FDesktopPlatformModule::Get()-&gt;GetEngineIdentifierFromRootDir(EngineRootDir, Identifier)</span><br><span class="line">RegisterEngineInstallation_Func=&gt;operation: RegisterEngineInstallation(RootDir, OutIdentifier)</span><br><span class="line">end=&gt;end: End</span><br><span class="line"></span><br><span class="line">WinMain_Func-&gt;Main_Func</span><br><span class="line">Main_Func-&gt;RegisterCurrentEngineDirectoryWithPrompt_Func</span><br><span class="line">RegisterCurrentEngineDirectoryWithPrompt_Func-&gt;RegisterCurrentEngineDirectory_Func</span><br><span class="line">RegisterCurrentEngineDirectory_Func-&gt;GetEngineIdentifierFromRootDir_Func</span><br><span class="line">GetEngineIdentifierFromRootDir_Func-&gt;RegisterEngineInstallation_Func</span><br><span class="line">RegisterEngineInstallation_Func-&gt;end</span><br></pre></td></tr></table></figure>
<p>向注册表写入的操作在<code>FDesktopPlatformWindows::RegisterEngineInstallation</code>这个函数中。<br>操作为将注册的引擎目录写入到<code>HKEY_CURRENT_USER\Software\Epic Games\Unreal Engine\Builds</code>中的字符串项中。<br>当右键<code>Switch Unreal Engine Version...</code>的时候，会修改<code>.uproject</code>文件中的<code>EngineAssociation</code>值：</p>
<p>其调用流如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">WinMain_Func=&gt;start: WinMain</span><br><span class="line">Main_Func=&gt;operation: Main(Arguments)</span><br><span class="line">SwitchVersion_Func=&gt;operation: SwitchVersion(const FString&amp; ProjectFileName)</span><br><span class="line">GetEngineIdentifierForProject_fUNC=&gt;operation: FDesktopPlatformModule::Get()-&gt;GetEngineIdentifierForProject(ProjectFileName, Identifier) // 获取当前选择的引擎</span><br><span class="line">SelectEngineInstallation_Func=&gt;operation: FPlatformInstallation::SelectEngineInstallation(Identifier) // 弹出选择引擎列表框，当前选择的为默认</span><br><span class="line">SetEngineIdentifierForProject_func=&gt;operation: FDesktopPlatformModule::Get()-&gt;SetEngineIdentifierForProject(ProjectFileName, Identifier) // 设置选择的引擎，并写入uproject文件</span><br><span class="line">ContentOnly=&gt;condition: Is Content Only Project?</span><br><span class="line">GenerateProjectFiles_func=&gt;operation: GenerateProjectFiles(ProjectFileName)</span><br><span class="line">end=&gt;end: End</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WinMain_Func-&gt;Main_Func</span><br><span class="line">Main_Func-&gt;SwitchVersion_Func</span><br><span class="line">SwitchVersion_Func-&gt;GetEngineIdentifierForProject_fUNC</span><br><span class="line">GetEngineIdentifierForProject_fUNC-&gt;SelectEngineInstallation_Func</span><br><span class="line">SelectEngineInstallation_Func-&gt;SetEngineIdentifierForProject_func</span><br><span class="line">SetEngineIdentifierForProject_func-&gt;ContentOnly</span><br><span class="line">ContentOnly(yes)-&gt;end</span><br><span class="line">ContentOnly(no)-&gt;GenerateProjectFiles_func</span><br><span class="line">GenerateProjectFiles_func-&gt;end</span><br></pre></td></tr></table></figure>
<p>执行项目文件写入的操作在<code>FDesktopPlatformBase::SetEngineIdentifierForProject</code>中：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">FDesktopPlatformBase::SetEngineIdentifierForProject</span><span class="params">(<span class="type">const</span> FString &amp;ProjectFileName, <span class="type">const</span> FString &amp;InIdentifier)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Load the project file</span></span><br><span class="line">  TSharedPtr&lt;FJsonObject&gt; ProjectFile = <span class="built_in">LoadProjectFile</span>(ProjectFileName);</span><br><span class="line">  <span class="keyword">if</span> (!ProjectFile.<span class="built_in">IsValid</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check if the project is a non-foreign project of the given engine installation. If so, blank the identifier </span></span><br><span class="line">  <span class="comment">// string to allow portability between source control databases. GetEngineIdentifierForProject will translate</span></span><br><span class="line">  <span class="comment">// the association back into a local identifier on other machines or syncs.</span></span><br><span class="line">  FString Identifier = InIdentifier;</span><br><span class="line">  <span class="keyword">if</span>(Identifier.<span class="built_in">Len</span>() &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    FString RootDir;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">GetEngineRootDirFromIdentifier</span>(Identifier, RootDir))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="type">const</span> FUProjectDictionary &amp;Dictionary = <span class="built_in">GetCachedProjectDictionary</span>(RootDir);</span><br><span class="line">      <span class="keyword">if</span>(!Dictionary.<span class="built_in">IsForeignProject</span>(ProjectFileName))</span><br><span class="line">      &#123;</span><br><span class="line">        Identifier.<span class="built_in">Empty</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set the association on the project and save it</span></span><br><span class="line">  ProjectFile-&gt;<span class="built_in">SetStringField</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;EngineAssociation&quot;</span>), Identifier);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">SaveProjectFile</span>(ProjectFileName, ProjectFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以如果你选择了一个项目使用编译版引擎，可以使用文本编辑器打开该项目的<code>.uproject</code>文件，可以看到其中的<code>EngineAssociation</code>项的值就是注册表中的引擎版本值。<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/Unreal-Select-Engine-Version.webp"></p>
<p>注：<a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/4.18/Engine/Source/Programs/UnrealVersionSelector/">UnrealVersionSelector</a>所支持的命令行参数及其用途在<a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/4.18/Engine/Source/Programs/UnrealVersionSelector/Private/UnrealVersionSelector.cpp#L224">UnrealVersionSelector.cpp#L224</a>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Main</span><span class="params">(<span class="type">const</span> TArray&lt;FString&gt;&amp; Arguments)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">bool</span> bRes = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Add the current directory to the list of installations</span></span><br><span class="line">    bRes = <span class="built_in">RegisterCurrentEngineDirectoryWithPrompt</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">1</span> &amp;&amp; Arguments[<span class="number">0</span>] == <span class="built_in">TEXT</span>(<span class="string">&quot;-register&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Add the current directory to the list of installations</span></span><br><span class="line">    bRes = <span class="built_in">RegisterCurrentEngineDirectory</span>(<span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">1</span> &amp;&amp; Arguments[<span class="number">0</span>] == <span class="built_in">TEXT</span>(<span class="string">&quot;-fileassociations&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Update all the settings.</span></span><br><span class="line">    bRes = <span class="built_in">UpdateFileAssociations</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">2</span> &amp;&amp; Arguments[<span class="number">0</span>] == <span class="built_in">TEXT</span>(<span class="string">&quot;-switchversion&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Associate with an engine label</span></span><br><span class="line">    bRes = <span class="built_in">SwitchVersion</span>(Arguments[<span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">3</span> &amp;&amp; Arguments[<span class="number">0</span>] == <span class="built_in">TEXT</span>(<span class="string">&quot;-switchversionsilent&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Associate with a specific engine label</span></span><br><span class="line">    bRes = <span class="built_in">SwitchVersionSilent</span>(Arguments[<span class="number">1</span>], Arguments[<span class="number">2</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">2</span> &amp;&amp; Arguments[<span class="number">0</span>] == <span class="built_in">TEXT</span>(<span class="string">&quot;-editor&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Open a project with the editor</span></span><br><span class="line">    bRes = <span class="built_in">LaunchEditor</span>(Arguments[<span class="number">1</span>], <span class="string">L&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">2</span> &amp;&amp; Arguments[<span class="number">0</span>] == <span class="built_in">TEXT</span>(<span class="string">&quot;-game&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Play a game using the editor executable</span></span><br><span class="line">    bRes = <span class="built_in">LaunchEditor</span>(Arguments[<span class="number">1</span>], <span class="string">L&quot;-game&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (Arguments.<span class="built_in">Num</span>() == <span class="number">2</span> &amp;&amp; Arguments[<span class="number">0</span>] == <span class="built_in">TEXT</span>(<span class="string">&quot;-projectfiles&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Generate Visual Studio project files</span></span><br><span class="line">    bRes = <span class="built_in">GenerateProjectFiles</span>(Arguments[<span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Invalid command line</span></span><br><span class="line">    FPlatformMisc::<span class="built_in">MessageBoxExt</span>(EAppMsgType::Ok, <span class="built_in">TEXT</span>(<span class="string">&quot;Invalid command line&quot;</span>), <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> bRes ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决-uproject右键生成失败"><a href="#解决-uproject右键生成失败" class="headerlink" title="解决.uproject右键生成失败"></a>解决.uproject右键生成失败</h3><p>首先要查看右键菜单所使用的<code>UnrealVersionSelector.exe</code>的路径，可以打开注册表:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CLASSES_ROOT\Unreal.ProjectFile</span><br></pre></td></tr></table></figure>
<p>然后找到<code>shell\open\command</code>条目查看<code>UnrealVersionSelector.exe</code>的位置(如果没有安装过源码版引擎则默认在EpicGamesLauncher的Binaries路径下)，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files (x86)\Epic Games\Launcher\Engine\Binaries\Win64\UnrealVersionSelector.exe&quot; /editor &quot;%1&quot;</span><br></pre></td></tr></table></figure>
<p>然后打开<code>C:\Program Files (x86)\Epic Games\Launcher\Engine\Binaries\Win64</code>，将<code>UnrealVersionSelector.exe</code>设置为以管理员权限启动即可(右键-属性-兼容性-以管理员身份运行此程序)。</p>
<h2 id="GamePlay"><a href="#GamePlay" class="headerlink" title="GamePlay"></a>GamePlay</h2><h3 id="UE宏库的问题"><a href="#UE宏库的问题" class="headerlink" title="UE宏库的问题"></a>UE宏库的问题</h3><p>在UE蓝图中使用宏库，在编辑了宏库里面的宏之后，只保存宏库是没用的，必须在用到宏库的蓝图里编译一遍才会生效，相当于蓝图里面的编译才会直接展开宏，否则还是原来未修改之前的版本，这问题实在太操蛋了。<br>在UE4.18.3问题存在，其他版本没试。</p>
<h3 id="UE使用Shipping模式打包的Saved目录"><a href="#UE使用Shipping模式打包的Saved目录" class="headerlink" title="UE使用Shipping模式打包的Saved目录"></a>UE使用Shipping模式打包的Saved目录</h3><p>UE项目在工程和<code>Develement</code>或<code>DebugGame</code>打包出来的<code>Saved</code>目录均包含在<code>项目目录</code>或<code>打包到的目标目录</code>下，其中包含<code>Autosaves</code>/<code>Backup</code>/<code>Config</code>/<code>Logs</code>/<code>Crashs</code>/<code>SaveGames</code>等等。<br>但是使用Shipping打包的不同，使用Shipping打包出来的游戏，Saved目录并不在<code>打包到的目标目录下</code>，而是在<code>C:/User/%username%/AppData/Local/ProjectName</code>下，<code>ProjectName</code>替换为你的项目名。</p>
<p>更多关于UE打包的内容可以看UE的文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Engine/Basics/Projects/Packaging">Packaging Projects</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/Development/BuildConfigurations">BuildConfigurations</a></li>
</ul>
<h3 id="CharacterMovement开启RVO避障"><a href="#CharacterMovement开启RVO避障" class="headerlink" title="CharacterMovement开启RVO避障"></a>CharacterMovement开启RVO避障</h3><p><code>CharacterMovementComponent</code>具有自动避障的功能，只需要启用<code>UseRVOAvoidance</code>。<br>但是记得在角色死亡之后关闭RVO的壁障，不然会导致怪物在空地上避障的问题。<br>可以使用<code>SetAvoidanceEnable</code>来关闭。</p>
<h3 id="VR弓的模型标准"><a href="#VR弓的模型标准" class="headerlink" title="VR弓的模型标准"></a>VR弓的模型标准</h3><p>VR中需要用的弓为SkeleMesh，模型的root骨骼点要位于抓取的位置(最好是弓箭握持中心点)，而且为了程序计算方便模型方向要求下图：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/vr-bow-mesh-rotation.webp"><br>这是为了方便计算VR玩家抓取弓到手上时的旋转计算：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/calc-vr-pickup-bow-rotation.webp"></p>
<blockquote>
<p>拉弓时<strong>抓弓的手</strong>提供Roll的旋转，Pitch与Yaw则由<strong>抓弓的手LookAt到拉弓的手</strong>所需要的旋转提供。</p>
</blockquote>
<p>所有的弓使用相同的模型旋转标准，这点美术上很好实现，如果不同程序调整上很麻烦。</p>
<p>而且箭的模型原点要在箭羽尾部：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/vr-arrow-mesh-pivot.webp"></p>
<p>做一把体验好的弓是个挺麻烦的事，重要的就是细节优化。</p>
<h3 id="UE换装的一个实现"><a href="#UE换装的一个实现" class="headerlink" title="UE换装的一个实现"></a>UE换装的一个实现</h3><p>在UE的<a target="_blank" rel="noopener" href="http://api.unrealengine.com/INT/API/Runtime/Engine/Components/USkinnedMeshComponent/index.html">USkinnedMeshComponent</a>中有这样一个函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ENGINE_API</span> USkinnedMeshComponent : <span class="keyword">public</span> UMeshComponent</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Set MasterPoseComponent for this component</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param NewMasterBoneComponent New MasterPoseComponent</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, Category=<span class="string">&quot;Components|SkinnedMesh&quot;</span>)</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">SetMasterPoseComponent</span><span class="params">(USkinnedMeshComponent* NewMasterBoneComponent)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>大概意思就是让当前的<code>SkinnedMeshComponent</code>随着<code>NewMasterBoneComponent</code>的姿态运动。<br>我们可以使用一组使用相同骨骼的模型来实现换装的功能，比如说头部、胸部、腿、脚、双手，让一个角色具有这五个单独的<code>USkinnedMeshComponent</code>模型组件来表示不同的部位。<br>让角色有一个带有动画的<code>USkinnedMeshComponent</code>当作身体，然后将上面的五个<code>USkinnedMeshComponent</code>的<code>MasterPose</code>设置为它。<br>此时各个部位都会随着身体的动画运动的，实现换装就直接修改各个部位的模型就可以了。</p>
<h3 id="从蓝图编译到C-代码"><a href="#从蓝图编译到C-代码" class="headerlink" title="从蓝图编译到C++代码"></a>从蓝图编译到C++代码</h3><p>UE支持从蓝图编译到C++代码，需要在<code>Project Setting</code>-<code>Packaging</code>-<code>Blueprints</code>里选择<code>Exclusive</code>(只有选择的蓝图资源会生成C++)或者<code>Inclusive</code>(为所有的蓝图资源生成C++)。<br>选择之后打包项目，打包成功后可以在项目的<code>Intermediate\Plugins\NativizedAssets\Windows\Game\Source\NativizedAssets</code>路径下的<code>public</code>/<code>private</code>目录里找到以蓝图名字开头的<code>.cpp</code>与<code>.h</code>文件。</p>
<h3 id="UE蓝图函数库无法在UObject对象中调用"><a href="#UE蓝图函数库无法在UObject对象中调用" class="headerlink" title="UE蓝图函数库无法在UObject对象中调用"></a>UE蓝图函数库无法在UObject对象中调用</h3><p>在编辑器中创建一个蓝图函数库(Blueprint Function Library)并创建一个函数，该函数是不能在蓝图的<code>Object</code>中调用的，会提示：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Function Requires A World Context.</span><br></pre></td></tr></table></figure>
<p>写一个测试的蓝图函数库生成C++代码：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-gEN-Cpp-Code-From-Bp-Asset.webp"><br>生成的C++代码如下(移除多余的部分，全部的代码可以在<a target="_blank" rel="noopener" href="https://gist.github.com/hxhb/69655c527024f06b1ddbcf3c29e7a816">这里</a>查看)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TestFuncLib_pf1448227310.h</span></span><br><span class="line"><span class="built_in">UFUNCTION</span>(BlueprintCallable, BlueprintPure, meta=(WorldContext=<span class="string">&quot;__WorldContext&quot;</span>, Category, OverrideNativeName=<span class="string">&quot;GetComponents&quot;</span>))</span><br><span class="line"><span class="function"><span class="type">static</span> TArray&lt;UActorComponent*&gt;  <span class="title">bpf__GetComponents__pf</span><span class="params">(AActor* bpp__pActor__pf, UClass* bpp__pCompClass__pf, UObject* bpp____WorldContext__pf)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TestFuncLib_pf1448227310.cpp</span></span><br><span class="line"><span class="function">TArray&lt;UActorComponent*&gt;  <span class="title">UTestFuncLib_C__pf1448227310::bpf__GetComponents__pf</span><span class="params">(AActor* bpp__pActor__pf, UClass* bpp__pCompClass__pf, UObject* bpp____WorldContext__pf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  TArray&lt;UActorComponent*&gt; bpp__ReturnValue__pf&#123;&#125;;</span><br><span class="line">  TArray&lt;UActorComponent*&gt; bpfv__CallFunc_GetComponentsByClass_ReturnValue__pf&#123;&#125;;</span><br><span class="line">  FString bpfv__CallFunc_GetDisplayName_ReturnValue__pf&#123;&#125;;</span><br><span class="line">  bpfv__CallFunc_GetDisplayName_ReturnValue__pf = UKismetSystemLibrary::<span class="built_in">GetDisplayName</span>(bpp____WorldContext__pf);</span><br><span class="line">  UKismetSystemLibrary::<span class="built_in">PrintString</span>(bpp____WorldContext__pf, bpfv__CallFunc_GetDisplayName_ReturnValue__pf, <span class="literal">true</span>, <span class="literal">true</span>, <span class="built_in">FLinearColor</span>(<span class="number">0.000000</span>,<span class="number">0.660000</span>,<span class="number">1.000000</span>,<span class="number">1.000000</span>), <span class="number">2.000000</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">IsValid</span>(bpp__pActor__pf))</span><br><span class="line">  &#123;</span><br><span class="line">    bpfv__CallFunc_GetComponentsByClass_ReturnValue__pf = bpp__pActor__pf-&gt;AActor::<span class="built_in">GetComponentsByClass</span>(bpp__pCompClass__pf);</span><br><span class="line">  &#125;</span><br><span class="line">  bpp__ReturnValue__pf = bpfv__CallFunc_GetComponentsByClass_ReturnValue__pf;</span><br><span class="line">  <span class="keyword">return</span> bpp__ReturnValue__pf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接把上面的代码抄到一个C++的蓝图函数库里是可以在UObject的对象中调用的…这就有毒了。</p>
<h3 id="UE中放置组件到骨骼插槽-socket"><a href="#UE中放置组件到骨骼插槽-socket" class="headerlink" title="UE中放置组件到骨骼插槽(socket)"></a>UE中放置组件到骨骼插槽(socket)</h3><p>在蓝图中直接可以在蓝图编辑器中设置<code>parent socket</code>属性来将一个组件放置到骨骼插槽中。<br>在C++中也一样，不过略微麻烦一点，来看一下ShooterGame中的代码示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShooterGame\Private\Weapons\ShooterWeapon.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AShooterWeapon::AttachMeshToPawn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (MyPawn)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Remove and hide both first and third person meshes</span></span><br><span class="line">    <span class="built_in">DetachMeshFromPawn</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For locally controller players we attach both weapons and let the bOnlyOwnerSee, bOwnerNoSee flags deal with visibility.</span></span><br><span class="line">    FName AttachPoint = MyPawn-&gt;<span class="built_in">GetWeaponAttachPoint</span>();</span><br><span class="line">    <span class="keyword">if</span>( MyPawn-&gt;<span class="built_in">IsLocallyControlled</span>() == <span class="literal">true</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      USkeletalMeshComponent* PawnMesh1p = MyPawn-&gt;<span class="built_in">GetSpecifcPawnMesh</span>(<span class="literal">true</span>);</span><br><span class="line">      USkeletalMeshComponent* PawnMesh3p = MyPawn-&gt;<span class="built_in">GetSpecifcPawnMesh</span>(<span class="literal">false</span>);</span><br><span class="line">      Mesh1P-&gt;<span class="built_in">SetHiddenInGame</span>( <span class="literal">false</span> );</span><br><span class="line">      Mesh3P-&gt;<span class="built_in">SetHiddenInGame</span>( <span class="literal">false</span> );</span><br><span class="line">      Mesh1P-&gt;<span class="built_in">AttachToComponent</span>(PawnMesh1p, FAttachmentTransformRules::KeepRelativeTransform, AttachPoint);</span><br><span class="line">      Mesh3P-&gt;<span class="built_in">AttachToComponent</span>(PawnMesh3p, FAttachmentTransformRules::KeepRelativeTransform, AttachPoint);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      USkeletalMeshComponent* UseWeaponMesh = <span class="built_in">GetWeaponMesh</span>();</span><br><span class="line">      USkeletalMeshComponent* UsePawnMesh = MyPawn-&gt;<span class="built_in">GetPawnMesh</span>();</span><br><span class="line">      UseWeaponMesh-&gt;<span class="built_in">AttachToComponent</span>(UsePawnMesh, FAttachmentTransformRules::KeepRelativeTransform, AttachPoint);</span><br><span class="line">      UseWeaponMesh-&gt;<span class="built_in">SetHiddenInGame</span>( <span class="literal">false</span> );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样是用的也是AttachToComponent，蓝图中也可以用相同名字的蓝图节点来attach到骨骼插槽上。</p>
<h3 id="Unreal中获取OpenLevel的Options"><a href="#Unreal中获取OpenLevel的Options" class="headerlink" title="Unreal中获取OpenLevel的Options"></a>Unreal中获取OpenLevel的Options</h3><p>在UE中加载关卡时，可以传一个<code>FString</code>的Options过去：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-OpenLebel-PassOptions.webp"></p>
<p>在被加载的关卡中可以通过<code>GetGameMode</code>来获取:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-OpenLebel-GetOptions.webp"></p>
<p>使用C++的代码是这样：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AGameModeBase* OurGameMode=UGameplayStatics::<span class="built_in">GetGameMode</span>(<span class="keyword">this</span>);</span><br><span class="line">FString LevelOptionString=OurGameMode-&gt;OptionsString;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>在切换关卡后，原关卡中创建出来的对象都会被销毁，解决的办法是使用GameMode的<code>GetSeamlessTravelActorList</code>来留存指定的Actor在切换关卡时不会被销毁。</p>
<h3 id="转换游戏场景中的3D位置到屏幕位置"><a href="#转换游戏场景中的3D位置到屏幕位置" class="headerlink" title="转换游戏场景中的3D位置到屏幕位置"></a>转换游戏场景中的3D位置到屏幕位置</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/ConvertWorldPositionToScreenPosition.webp"></p>
<h3 id="设置鼠标的光标在viewport内的相对位置"><a href="#设置鼠标的光标在viewport内的相对位置" class="headerlink" title="设置鼠标的光标在viewport内的相对位置"></a>设置鼠标的光标在viewport内的相对位置</h3><p>首先安装LowEntry-ExtendedStandardLibrary这个插件，可以使用其中的<code>ULowEntryExtendedStandardLibrary::SetMousePosition</code>函数来设置鼠标的光标在viewport内的相对位置，viewport的大小可以通过<code>UWidgetLayoutLibrary::GetViewportSize</code>来获取。</p>
<h3 id="UE启动游戏后鼠标焦点不在窗口内"><a href="#UE启动游戏后鼠标焦点不在窗口内" class="headerlink" title="UE启动游戏后鼠标焦点不在窗口内"></a>UE启动游戏后鼠标焦点不在窗口内</h3><p>可以使用<code>SetInputModeGameAndUI</code>来设置鼠标的焦点在窗口内，<code>InMourseLockMode</code>设置为<code>LockAlways</code>即可。<br>在启动游戏时使用这个操作就可以在开始游戏时鼠标的焦点就在游戏窗口内，从而避免想要点击窗口上的UI需要先点击一遍游戏窗口。</p>
<h3 id="判断一个特效是否循环"><a href="#判断一个特效是否循环" class="headerlink" title="判断一个特效是否循环"></a>判断一个特效是否循环</h3><p>从一个<code>UParticleSystem</code>的<code>Emitter</code>的<code>Required</code>的<code>Emitter Loops</code>为0则是循环特效：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/unreal_loop_particle_system.webp"></p>
<p>UE提供了方法可以判断一个特效是不是循环特效:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UParticleSystem::IsLooping</span><span class="params">()</span><span class="type">const</span></span>&#123; <span class="comment">/*...*/</span> &#125;</span><br></pre></td></tr></table></figure>
<p>只要该特效里有一个循环的Emitter，则该特效就是循环的。<br>但是该方法没有暴露给蓝图，可以写个函数库封装给蓝图。</p>
<h3 id="跨模块使用类注意是否导出符号"><a href="#跨模块使用类注意是否导出符号" class="headerlink" title="跨模块使用类注意是否导出符号"></a>跨模块使用类注意是否导出符号</h3><p>在继承/访问UE引擎内的类时，一定要注意类是否具有导出符号，没有导出符号的类是没办法链接到定义的。<br>如UE<code>Engine</code>模块下的<code>FParticleSpriteEmitterInstance</code>这个类就是没有导出符号的。</p>
<h3 id="Blueprint创建异步节点"><a href="#Blueprint创建异步节点" class="headerlink" title="Blueprint创建异步节点"></a>Blueprint创建异步节点</h3><p>在工程中有一些异步操作的需求，比如下载文件的行为，一个下载命令等待下载完成之后回调，而且要尽量避免太多的事件绑定和解绑操作。<br>在蓝图的节点中有一些异步的操作，比如<code>PlayMontage</code>/<code>DownloadImage</code>等，都是异步操作中有多个输出节点的:<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/bp-node-playmontage-and-downloadImage.webp"><br>我们能不能自己写一个这样的异步操作的节点呢？那必然是可以的。<br>可以在<code>Engine\Source\Runtime\UMG\Public\Blueprint\AsyncTaskDownloadImage.h</code>中查看<a target="_blank" rel="noopener" href="https://api.unrealengine.com/INT/BlueprintAPI/Class/AsyncTaskDownloadImage/DownloadImage/index.html">DownloadImage</a>节点的实现(<a target="_blank" rel="noopener" href="https://api.unrealengine.com/INT/API/Runtime/UMG/Blueprint/UAsyncTaskDownloadImage/index.html">C++API</a>)。<br>可以自己仿照这自己写一个出来：</p>
<ol>
<li>关键就是要继承<code>UBlueprintAsyncActionBase</code>，这个是必须的。</li>
<li>然后写一个<code>static</code>的函数，返回类的指针，并用<code>UFUNCTION</code>的<code>mate</code>标记为<code>BlueprintInternalUseOnly=&quot;true&quot;</code></li>
<li>声明并定义几个派发器成员，这些派发器成员就是异步的节点，也就是蓝图节点右侧的exec节点。</li>
</ol>
<p>我们先来看一下<code>DownloadImage</code>的声明:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UTexture2DDynamic</span>;</span><br><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(FDownloadImageDelegate, UTexture2DDynamic*, Texture);</span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UMG_API</span> UAsyncTaskDownloadImage : <span class="keyword">public</span> UBlueprintAsyncActionBase</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, meta=( BlueprintInternalUseOnly=<span class="string">&quot;true&quot;</span> ))</span><br><span class="line">	<span class="function"><span class="type">static</span> UAsyncTaskDownloadImage* <span class="title">DownloadImage</span><span class="params">(FString URL)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintAssignable)</span><br><span class="line">	FDownloadImageDelegate OnSuccess;</span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintAssignable)</span><br><span class="line">	FDownloadImageDelegate OnFail;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Start</span><span class="params">(FString URL)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">/** Handles image requests coming from the web */</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">HandleImageRequest</span><span class="params">(FHttpRequestPtr HttpRequest, FHttpResponsePtr HttpResponse, <span class="type">bool</span> bSucceeded)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>对比上面的DownloadImage的节点，可以看到：<br>0. 首先声明了一个动态多播代理<code>FDownloadImageDelegate</code>，并且需要传入一个参数</p>
<ol>
<li><code>UAsyncTaskDownloadImage</code>类中声明了两个事件派发器<code>OnSuccess</code>和<code>OnFail</code>，这也是蓝图节点右侧的Exec和参数<code>Texture</code>，本质都是派发器(动态多播代理)</li>
<li><code>UAsyncTaskDownloadImage</code>的<code>static</code>函数<code>DownloadImage</code>接收一个FString的参数，返回一个<code>UAsyncTaskDownloadImage*</code>，这个返回就是把派发器的执行节点在蓝图中显示出来</li>
</ol>
<p>即：声明的动态多播的成员和该多播的参数都会显示在蓝图节点的右侧。</p>
<p>我自己实现了一个异步行为的操作，先在蓝图中看操作：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/create-async-task-and-action.webp"><br>行为就是，先创建一个<code>AsyncActionObject</code>的对象作为后期触发异步操作的对象，然后执行<code>CreateAsyncTask</code>里面对上一步创建的<code>AsyncActionObject</code>进行事件绑定。<br>然后我们就可以在那个ActionObj调用<code>OnActionStart</code>之类的操作就可以调用<code>CreateAsyncTask</code>右侧的相关节点。<br>注意：我做的限制是，一个对象对应一个Task,如果当前传入的<code>AsyncActionObject</code>正在被其他的task绑定，则创建task会失败。<br>然后就是代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AsyncTask.h</span></span><br><span class="line"><span class="comment">// Copyright 1998-2017 Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"><span class="comment">// Copyright 1998-2017 Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AsyncActionObject.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// unreal header</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Array.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Kismet/KismetSystemLibrary.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UObject/ObjectMacros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Kismet/BlueprintAsyncActionBase.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AsyncTask.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PRINT_LOG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT_LOG(lOG_TEXT) UKismetSystemLibrary::PrintString(this,lOG_TEXT,true,true);</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PRINT_ASYNC_ACTION_TOOLS_DEBUG_INFO</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT_ASYNC_ACTION_TOOLS_DEBUG_INFO 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(FAsyncTaskDelegate,UAsyncActionObject*,ActionObj);</span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(BlueprintType)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UAsyncTask</span> : <span class="keyword">public</span> UBlueprintAsyncActionBase</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_UCLASS_BODY</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable, meta=( BlueprintInternalUseOnly=<span class="string">&quot;true&quot;</span> ))</span><br><span class="line">	<span class="function"><span class="type">static</span> UAsyncTask* <span class="title">CreateAsyncTask</span><span class="params">(UAsyncActionObject* ActionObj)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintAssignable)</span><br><span class="line">	FAsyncTaskDelegate OnStart;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintAssignable)</span><br><span class="line">	FAsyncTaskDelegate OnAbort;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintAssignable)</span><br><span class="line">	FAsyncTaskDelegate OnUpdate;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(BlueprintAssignable)</span><br><span class="line">	FAsyncTaskDelegate OnFinishd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">StartTask</span><span class="params">(UAsyncActionObject* ActionObj)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnActionStart</span><span class="params">(UAsyncActionObject* ActionObj)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnActionAbort</span><span class="params">(UAsyncActionObject* ActionObj)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnActionUpdate</span><span class="params">(UAsyncActionObject* ActionObj)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnActionFinishd</span><span class="params">(UAsyncActionObject* ActionObj)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后是实现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AsyncTask.cpp</span></span><br><span class="line"><span class="comment">// Copyright 1998-2017 Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"><span class="comment">// Copyright 1998-2017 Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AsyncTask.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Modules/ModuleManager.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------------------------------//</span></span><br><span class="line"><span class="comment">// UAsyncTask</span></span><br><span class="line"><span class="comment">//----------------------------------------------------------------------//</span></span><br><span class="line"></span><br><span class="line">UAsyncTask::<span class="built_in">UAsyncTask</span>(<span class="type">const</span> FObjectInitializer&amp; ObjectInitializer)</span><br><span class="line">	: <span class="built_in">Super</span>(ObjectInitializer)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> ( <span class="built_in">HasAnyFlags</span>(RF_ClassDefaultObject) == <span class="literal">false</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">AddToRoot</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">UAsyncTask* <span class="title">UAsyncTask::CreateAsyncTask</span><span class="params">(UAsyncActionObject* ActionObj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	UAsyncTask* AsyncActionTask = <span class="built_in">NewObject</span>&lt;UAsyncTask&gt;();</span><br><span class="line">	AsyncActionTask-&gt;<span class="built_in">StartTask</span>(ActionObj);</span><br><span class="line">	<span class="keyword">return</span> AsyncActionTask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncTask::StartTask</span><span class="params">(UAsyncActionObject* ActionObj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(ActionObj &amp;&amp; !ActionObj-&gt;<span class="built_in">Action_IsRunning</span>())</span><br><span class="line">	&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_TOOLS_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncTask::StartTask Bind Event&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		(ActionObj-&gt;OnStart).<span class="built_in">BindUObject</span>(<span class="keyword">this</span>,&amp;UAsyncTask::OnActionStart);</span><br><span class="line">		(ActionObj-&gt;OnAbort).<span class="built_in">BindUObject</span>(<span class="keyword">this</span>,&amp;UAsyncTask::OnActionAbort);</span><br><span class="line">		(ActionObj-&gt;OnUpdate).<span class="built_in">BindUObject</span>(<span class="keyword">this</span>,&amp;UAsyncTask::OnActionUpdate);</span><br><span class="line">		(ActionObj-&gt;OnFinishd).<span class="built_in">BindUObject</span>(<span class="keyword">this</span>,&amp;UAsyncTask::OnActionFinishd);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncTask::OnActionStart</span><span class="params">(UAsyncActionObject* ActionObj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_TOOLS_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncTask::OnStart&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	OnStart.<span class="built_in">Broadcast</span>(ActionObj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncTask::OnActionAbort</span><span class="params">(UAsyncActionObject* ActionObj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_TOOLS_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncTask::OnActionAbort&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	OnAbort.<span class="built_in">Broadcast</span>(ActionObj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncTask::OnActionUpdate</span><span class="params">(UAsyncActionObject* ActionObj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_TOOLS_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncTask::OnActionUpdate&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	OnUpdate.<span class="built_in">Broadcast</span>(ActionObj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncTask::OnActionFinishd</span><span class="params">(UAsyncActionObject* ActionObj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_TOOLS_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncTask::OnActionFinishd&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	OnFinishd.<span class="built_in">Broadcast</span>(ActionObj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AsyncActionObject类的声明:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AsyncActionObject.h</span></span><br><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// unreal header</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Array.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Kismet/KismetSystemLibrary.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UObject/NoExportTypes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AsyncActionObject.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PRINT_LOG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT_LOG(lOG_TEXT) UKismetSystemLibrary::PrintString(this,lOG_TEXT,true,true);</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UAsyncActionObject</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">DECLARE_DELEGATE_OneParam</span>(FAsyncActionDelegate,UAsyncActionObject*);</span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(BlueprintType,Blueprintable)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UAsyncActionObject</span> : <span class="keyword">public</span> UObject</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">UAsyncActionObject</span>(<span class="type">const</span> FObjectInitializer&amp; objectInitializer);</span><br><span class="line">	FAsyncActionDelegate OnStart;</span><br><span class="line">	FAsyncActionDelegate OnAbort;</span><br><span class="line">	FAsyncActionDelegate OnUpdate;</span><br><span class="line">	FAsyncActionDelegate OnFinishd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">OnActionStart</span><span class="params">(FString&amp; rReason)</span></span>;</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnActionAbort</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnActionUpdate</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnActionFinishd</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">// Action status (BP Executable function)</span></span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">Action_IsRunning</span><span class="params">()</span><span class="type">const</span></span>;</span><br><span class="line">	<span class="built_in">UFUNCTION</span>(BlueprintCallable)</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">Action_ExecutableStart</span><span class="params">()</span><span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="comment">// End Action</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">EndAction</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">UnBindAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">InitDelegateList</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">Action_IsStarted</span><span class="params">()</span><span class="type">const</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">Action_EventIsBinded</span><span class="params">()</span><span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="type">bool</span> mActionStarted=<span class="literal">false</span>;</span><br><span class="line">	TArray&lt;FAsyncActionDelegate*&gt; DelegateList;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>以及它的实现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AsyncActionObject.cpp</span></span><br><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"><span class="comment">// Copyright 1998-2017 Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AsyncActionObject.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">UAsyncActionObject::<span class="built_in">UAsyncActionObject</span>(<span class="type">const</span> FObjectInitializer&amp; objectInitializer)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">		<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncActionObject::UAsyncActionObject&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	<span class="built_in">InitDelegateList</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UAsyncActionObject::OnActionStart</span><span class="params">(FString&amp; rReason)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	rReason.<span class="built_in">Reset</span>();</span><br><span class="line">	<span class="type">bool</span> local_bResault=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Action_ExecutableStart</span>())</span><br><span class="line">	&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">		<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncActionObject::OnActionStart&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		mActionStarted=<span class="literal">true</span>;</span><br><span class="line">		OnStart.<span class="built_in">ExecuteIfBound</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		local_bResault=<span class="literal">true</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">		<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;call UAsyncActionObject::OnActionStart Faild.&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">		local_bResault=<span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">Action_IsStarted</span>())</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">		<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;StartFaild: Action is Started.&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">			rReason.<span class="built_in">Append</span>(<span class="built_in">FString</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Action is Started.\n&quot;</span>)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="built_in">Action_EventIsBinded</span>())</span><br><span class="line">		&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">		<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;StartFaild: Action is not bind anything event.&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">			rReason.<span class="built_in">Append</span>(<span class="built_in">FString</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Action is not bind to anything Task&quot;</span>)));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> local_bResault;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncActionObject::OnActionAbort</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Action_IsRunning</span>())</span><br><span class="line">	&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncActionObject::OnActionAbort&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		OnAbort.<span class="built_in">ExecuteIfBound</span>(<span class="keyword">this</span>);</span><br><span class="line">		<span class="built_in">EndAction</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncActionObject::OnActionUpdate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Action_IsRunning</span>())</span><br><span class="line">	&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncActionObject::OnActionUpdate&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		OnUpdate.<span class="built_in">ExecuteIfBound</span>(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncActionObject::OnActionFinishd</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Action_IsRunning</span>())</span><br><span class="line">	&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncActionObject::OnActionFinishd&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		OnFinishd.<span class="built_in">ExecuteIfBound</span>(<span class="keyword">this</span>);</span><br><span class="line">		<span class="built_in">EndAction</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncActionObject::EndAction</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Action_IsRunning</span>())</span><br><span class="line">	&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncActionObject::EndAction&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		<span class="built_in">UnBindAll</span>();</span><br><span class="line">		mActionStarted=<span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncActionObject::UnBindAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> PRINT_ASYNC_ACTION_OBJ_DEBUG_INFO</span></span><br><span class="line">	<span class="built_in">PRINT_LOG</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;UAsyncActionObject::UnBindAll&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span>&amp; DeleIndex:DelegateList)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(DeleIndex-&gt;<span class="built_in">IsBound</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			DeleIndex-&gt;<span class="built_in">Unbind</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UAsyncActionObject::InitDelegateList</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">Action_IsStarted</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		DelegateList.<span class="built_in">AddUnique</span>(&amp;OnStart);</span><br><span class="line">		DelegateList.<span class="built_in">AddUnique</span>(&amp;OnAbort);</span><br><span class="line">		DelegateList.<span class="built_in">AddUnique</span>(&amp;OnUpdate);</span><br><span class="line">		DelegateList.<span class="built_in">AddUnique</span>(&amp;OnFinishd);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UAsyncActionObject::Action_EventIsBinded</span><span class="params">()</span><span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">bool</span> EventIsBinded=<span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span>&amp; DeleIndex:DelegateList)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(!DeleIndex-&gt;<span class="built_in">IsBound</span>())</span><br><span class="line">			EventIsBinded=<span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> EventIsBinded;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UAsyncActionObject::Action_IsStarted</span><span class="params">()</span><span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> mActionStarted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UAsyncActionObject::Action_IsRunning</span><span class="params">()</span><span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Action_IsStarted</span>() &amp;&amp; <span class="built_in">Action_EventIsBinded</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UAsyncActionObject::Action_ExecutableStart</span><span class="params">()</span><span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> !<span class="built_in">Action_IsStarted</span>() &amp;&amp; <span class="built_in">Action_EventIsBinded</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实就是本质上裹了两层派发器而已…<br>举个例子的用途：可以在行为树里监听某个动画被终止或者结束了之后然后再执行其他的行为，可以解决不同模块之间之间的耦合。</p>
<h3 id="UE引用windows头文件的警告-错误"><a href="#UE引用windows头文件的警告-错误" class="headerlink" title="UE引用windows头文件的警告/错误"></a>UE引用windows头文件的警告/错误</h3><p>如果你在UE中使用了<code>windows.h</code>在VS可能会爆出4668这样的错误,在之前的UE版本中是警告,但是在UE4.18变成了错误,UE本身对windowsAPI的头文件做了封装,可以包含相应的:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="comment">// UE中</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Windows/MinWindows.h&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>或者不用这个办法,使用:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4668)</span></span><br></pre></td></tr></table></figure>
<p>也是可以的.</p>
<p>而且,如果你在代码里用到了WindowsAPI,如<code>windows.h</code>等.<br>可能会遇到下面类似这样的错误:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&gt;C:\Program Files\Epic Games\UE_4.15\Engine\Source\Runtime\Core\Public\Async/TaskGraphInterfaces.h(892): error C2039: <span class="string">&#x27;__faststorefence&#x27;</span>: is not a member of <span class="string">&#x27;FWindowsPlatformMisc&#x27;</span></span><br><span class="line">1&gt;c:\program files\epic games\ue_4.15\engine\<span class="built_in">source</span>\runtime\core\public\Windows/WindowsPlatformMisc.h(33): note: see declaration of <span class="string">&#x27;FWindowsPlatformMisc&#x27;</span></span><br><span class="line">1&gt;C:\Program Files\Epic Games\UE_4.15\Engine\Source\Runtime\Core\Public\Async/TaskGraphInterfaces.h(868): note: <span class="keyword">while</span> compiling class template member <span class="keyword">function</span> <span class="string">&#x27;void TGraphTask&lt;FFunctionGraphTask&gt;::ExecuteTask(TArray&lt;FBaseGraphTask *,FDefaultAllocator&gt; &amp;,ENamedThreads::Type)&#x27;</span></span><br><span class="line">1&gt;C:\Program Files\Epic Games\UE_4.15\Engine\Source\Runtime\Core\Public\Async/TaskGraphInterfaces.h(1379): note: see reference to class template instantiation <span class="string">&#x27;TGraphTask&lt;FFunctionGraphTask&gt;&#x27;</span> being compiled</span><br></pre></td></tr></table></figure>
<p>解决这个问题的办法是把这些windowsAPI的头文件不要在UE的头文件中包含,移动到使用这些windowsAPI的.cpp中即可.</p>
<h3 id="UE获取光标在窗口的相对比例"><a href="#UE获取光标在窗口的相对比例" class="headerlink" title="UE获取光标在窗口的相对比例"></a>UE获取光标在窗口的相对比例</h3><p>首先先要获取当前的窗口大小，可以通过<code>UGameViewportClient</code>获得<code>SWindow</code>，进而可以通过<code>SWindow::GetSizeInScreen</code>得到窗口的大小：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetWindowSize</span><span class="params">(<span class="type">bool</span>&amp; Success, int32&amp; Width, int32&amp; Height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Success = <span class="literal">false</span>;</span><br><span class="line">  Width = <span class="number">0</span>;</span><br><span class="line">  Height = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(GEngine == <span class="literal">nullptr</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  UGameViewportClient* ViewportClient = GEngine-&gt;GameViewport;</span><br><span class="line">  <span class="keyword">if</span>(ViewportClient == <span class="literal">nullptr</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  TSharedPtr&lt;SWindow&gt; Window = ViewportClient-&gt;<span class="built_in">GetWindow</span>();</span><br><span class="line">  <span class="keyword">if</span>(!Window.<span class="built_in">IsValid</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  FVector2D Size = Window-&gt;<span class="built_in">GetSizeInScreen</span>();</span><br><span class="line"></span><br><span class="line">  Success = <span class="literal">true</span>;</span><br><span class="line">  Width = Size.X;</span><br><span class="line">  Height = Size.Y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后得到光标在当前窗口的位置，可以通过<code>APlayerController::GetMousePosition</code>来得到(其实他也是通过Viveport来得到的)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">APlayerController::GetMousePosition</span><span class="params">(<span class="type">float</span>&amp; LocationX, <span class="type">float</span>&amp; LocationY)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">bool</span> bGotMousePosition = <span class="literal">false</span>;</span><br><span class="line">  ULocalPlayer* LocalPlayer = <span class="built_in">Cast</span>&lt;ULocalPlayer&gt;(Player);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (LocalPlayer &amp;&amp; LocalPlayer-&gt;ViewportClient)</span><br><span class="line">  &#123;</span><br><span class="line">    FVector2D MousePosition;</span><br><span class="line"></span><br><span class="line">    bGotMousePosition = LocalPlayer-&gt;ViewportClient-&gt;<span class="built_in">GetMousePosition</span>(MousePosition);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bGotMousePosition)</span><br><span class="line">    &#123;</span><br><span class="line">      LocationX = MousePosition.X;</span><br><span class="line">      LocationY = MousePosition.Y;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> bGotMousePosition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后两者相除即可得到鼠标在当前窗口的相对位置。</p>
<h3 id="UE-SceneCapture2D捕获的gamma值"><a href="#UE-SceneCapture2D捕获的gamma值" class="headerlink" title="UE SceneCapture2D捕获的gamma值"></a>UE SceneCapture2D捕获的gamma值</h3><p>在使用<code>USceneCapture2D</code>捕获画面到<code>RenderTarget</code>使用<code>Spectator Screen</code>再贴到屏幕上时发现颜色不对：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE_SceneCapture2D_To_RenderTarget_Texture_Darker.webp"></p>
<p>解决的办法是：</p>
<ol>
<li>设置SceneCapture2D的<code>CaptureSouce</code>为<code>Final Color (LDR) in RGB</code></li>
<li>设置RenderTarget资源的Gamma值为<code>2.2</code>就看起来和原图十分接近了</li>
</ol>
<h3 id="蓝图Event参数的一个骚操作"><a href="#蓝图Event参数的一个骚操作" class="headerlink" title="蓝图Event参数的一个骚操作"></a>蓝图Event参数的一个骚操作</h3><p>在一些插件中看到了类似这种的操作：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/bp-use-otherevent-args.webp"></p>
<p>其实实际上，Unreal蓝图的事件节点(Event)的参数是类的成员变量(data member of class)，所以可以在其他的地方直接使用他的参数。</p>
<p>类似的问题还有delay的操作：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/bp-twice-call-delay-event.webp"></p>
<h3 id="UE使用UProjectileMovementComponent的碰撞检测问题"><a href="#UE使用UProjectileMovementComponent的碰撞检测问题" class="headerlink" title="UE使用UProjectileMovementComponent的碰撞检测问题"></a>UE使用UProjectileMovementComponent的碰撞检测问题</h3><p>在UE中使用<a target="_blank" rel="noopener" href="https://api.unrealengine.com/INT/API/Runtime/Engine/GameFramework/UProjectileMovementComponent/index.html">UProjectileMovementComponent</a>弹射组件来做一些比如弓箭之类的功能，可能会因为速度太快的原因导致碰撞无法被触发。<br>记录一下这个问题留待后面研究。</p>
<h2 id="Config-and-Editor"><a href="#Config-and-Editor" class="headerlink" title="Config and Editor"></a>Config and Editor</h2><h3 id="修改UE的编辑器模式下的Esc退出快捷键"><a href="#修改UE的编辑器模式下的Esc退出快捷键" class="headerlink" title="修改UE的编辑器模式下的Esc退出快捷键"></a>修改UE的编辑器模式下的Esc退出快捷键</h3><p>打开<code>Editor Preferences</code>-<code>Keybord Shortcuts</code>修改<code>Play World(PIE/SIE)</code>的按键即可。<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-change-Stop-keyshortcuts-in-PIE-mode.webp"></p>
<h3 id="UE在编辑器中显示插件的Content"><a href="#UE在编辑器中显示插件的Content" class="headerlink" title="UE在编辑器中显示插件的Content"></a>UE在编辑器中显示插件的Content</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-Show-Plugins-Content-In-Editor-ContentBroser.webp"></p>
<h3 id="修改UE编译时的parallel数量"><a href="#修改UE编译时的parallel数量" class="headerlink" title="修改UE编译时的parallel数量"></a>修改UE编译时的parallel数量</h3><p>修改下列文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Engine/Saved/UnrealBuildTool/BuildConfiguration.xml</span><br><span class="line">User Folder/AppData/Roaming/Unreal Engine/UnrealBuildTool/BuildConfiguration.xml</span><br><span class="line">My Documents/Unreal Engine/UnrealBuildTool/BuildConfiguration.xml</span><br></pre></td></tr></table></figure>
<p>如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">xmlns</span>=<span class="string">&quot;https://www.unrealengine.com/BuildConfiguration&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">BuildConfiguration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">MaxProcessorCount</span>&gt;</span>1<span class="tag">&lt;/<span class="name">MaxProcessorCount</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">BuildConfiguration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>MaxProcessorCount</code>即是修改本地执行的最大处理器数。<br>更多的confiuration参数可以看：<a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Programming/UnrealBuildSystem/Configuration">UBT configuration</a></p>
<h3 id="UE-Android打包将数据存放在obb文件中"><a href="#UE-Android打包将数据存放在obb文件中" class="headerlink" title="UE Android打包将数据存放在obb文件中"></a>UE Android打包将数据存放在obb文件中</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/ue-package-android-data-placed-into-obb-file.webp"></p>
<h3 id="UE编辑器模式下焦点不在窗口内的卡顿"><a href="#UE编辑器模式下焦点不在窗口内的卡顿" class="headerlink" title="UE编辑器模式下焦点不在窗口内的卡顿"></a>UE编辑器模式下焦点不在窗口内的卡顿</h3><p>在Windows平台上运行UE时如果在编辑器内Play游戏，若当前的焦点不在编辑器/VR应用内，会减少对CPU的占用，从而出现卡顿的问题(打包出来不会出现这个问题)。<br>其实是因为UE在编辑器环境下做了不在焦点内的检测：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Runtime/ApplicationCore/Private/Windows/WindowsPlatformApplicationMisc.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FWindowsPlatformApplicationMisc::PumpMessages</span><span class="params">(<span class="type">bool</span> bFromMainLoop)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!bFromMainLoop)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="function">TGuardValue&lt;<span class="type">bool</span>&gt; <span class="title">PumpMessageGuard</span><span class="params">( GPumpingMessagesOutsideOfMainLoop, <span class="literal">true</span> )</span></span>;</span><br><span class="line">		<span class="comment">// Process pending windows messages, which is necessary to the rendering thread in some rare cases where D3D</span></span><br><span class="line">		<span class="comment">// sends window messages (from IDXGISwapChain::Present) to the main thread owned viewport window.</span></span><br><span class="line">		<span class="built_in">WinPumpSentMessages</span>();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GPumpingMessagesOutsideOfMainLoop = <span class="literal">false</span>;</span><br><span class="line">	<span class="built_in">WinPumpMessages</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Determine if application has focus</span></span><br><span class="line">	<span class="type">bool</span> HasFocus = FApp::<span class="built_in">UseVRFocus</span>() ? FApp::<span class="built_in">HasVRFocus</span>() : FWindowsPlatformApplicationMisc::<span class="built_in">IsThisApplicationForeground</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// If editor thread doesn&#x27;t have the focus, don&#x27;t suck up too much CPU time.</span></span><br><span class="line">	<span class="keyword">if</span>( GIsEditor )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">static</span> <span class="type">bool</span> HadFocus=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>( HadFocus &amp;&amp; !HasFocus )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// Drop our priority to speed up whatever is in the foreground.</span></span><br><span class="line">			<span class="built_in">SetThreadPriority</span>( <span class="built_in">GetCurrentThread</span>(), THREAD_PRIORITY_BELOW_NORMAL );</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>( HasFocus &amp;&amp; !HadFocus )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// Boost our priority back to normal.</span></span><br><span class="line">			<span class="built_in">SetThreadPriority</span>( <span class="built_in">GetCurrentThread</span>(), THREAD_PRIORITY_NORMAL );</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>( !HasFocus )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// Sleep for a bit to not eat up all CPU time.</span></span><br><span class="line">			FPlatformProcess::<span class="built_in">Sleep</span>(<span class="number">0.005f</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		HadFocus = HasFocus;</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只需要把<code>FPlatformProcess::Sleep(0.005f);</code>这一行注释掉就可以了。</p>
<h3 id="Win10下解决UE编辑器内编译日志的中文乱码"><a href="#Win10下解决UE编辑器内编译日志的中文乱码" class="headerlink" title="Win10下解决UE编辑器内编译日志的中文乱码"></a>Win10下解决UE编辑器内编译日志的中文乱码</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/fix-unreal-compiler-error-chinese-character-messy-code.webp"></p>
<p>注意：可能会出现某些软件内的编码问题(如GBK编码出现烫烫烫/锟斤拷等)。</p>
<h2 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h2><h3 id="ObservedKeyNames-Num-gt-0"><a href="#ObservedKeyNames-Num-gt-0" class="headerlink" title="ObservedKeyNames.Num()&gt;0"></a>ObservedKeyNames.Num()&gt;0</h3><p>解决详情具体看：<a href="https://imzlp.com/posts/359/">UE Package Error:ObservedKeyNames.Num()&gt;0</a></p>
<h3 id="UE-Package-Error-RenderDocPlugin"><a href="#UE-Package-Error-RenderDocPlugin" class="headerlink" title="UE Package Error:RenderDocPlugin"></a>UE Package Error:RenderDocPlugin</h3><blockquote>
<p>RenderDocPlugin: Error: unable to initialize the plugin because no RenderDoc libray has been located.</p>
</blockquote>
<p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/ue-package-renderdoc-plugin-error.webp"><br>解决办法：打包之前禁用掉RenderDocPlugin这个插件。</p>
<h3 id="UE4打包32bit要求16byte对齐错误"><a href="#UE4打包32bit要求16byte对齐错误" class="headerlink" title="UE4打包32bit要求16byte对齐错误"></a>UE4打包32bit要求16byte对齐错误</h3><p>在引擎中选择32bit平台打包的时候会出现下列错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error C2719: <span class="string">&#x27;SpawnTransform&#x27;</span>: formal parameter with requested alignment of 16 won<span class="string">&#x27;t be aligned</span></span><br></pre></td></tr></table></figure>
<p>这是因为在代码里使用pass-by-value的方式传递了<code>FTransform</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">AProps* <span class="title">SpawnProps</span><span class="params">(FTransform SpawnTransform)</span></span>;</span><br></pre></td></tr></table></figure>
<p>因为FTransform要求使用16byte对齐：<a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/b70f31f6645d764bcb55829228918a6e3b571e0b/Engine/Source/Runtime/Core/Public/Math/TransformVectorized.h#L36">Math/TransformVectorized.h#L36</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MS_ALIGN</span>(<span class="number">16</span>) <span class="keyword">struct</span> <span class="title class_">FTransform</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MS_ALIGN</code>这个宏是在<a target="_blank" rel="noopener" href="https://github.com/EpicGames/UnrealEngine/blob/b70f31f6645d764bcb55829228918a6e3b571e0b/Engine/Source/Runtime/Core/Public/Windows/WIndowsPlatform.h#L131">Core/Public/Windows/WindowsPlatform.h#L131</a>中定义的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Alignment.</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__clang__)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> GCC_PACK(n) __attribute__((packed,aligned(n)))</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> GCC_ALIGN(n) __attribute__((aligned(n)))</span></span><br><span class="line">	<span class="meta">#<span class="keyword">if</span> defined(_MSC_VER)</span></span><br><span class="line">		<span class="meta">#<span class="keyword">define</span> MS_ALIGN(n) __declspec(align(n)) <span class="comment">// With -fms-extensions, Clang will accept either alignment attribute</span></span></span><br><span class="line">	<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> MS_ALIGN(n) __declspec(align(n))</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>所以<code>FTransform</code>要求的是16byte对齐。</p>
<blockquote>
<p>FTransform is implemented using vector intrinsics, and instances of it need to have 16-byte alignment. I think the stack is guaranteed to be aligned to 16-bytes on Win64 so the compiler can pass it on the stack correctly, but there’s no such guarantee on Win32 (which is what we use for shipping builds).</p>
</blockquote>
<p>那么改为传递指针或引用就可以了(传引用和传指针均是<code>sizeof(void*)</code>的大小)：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">AProps* <span class="title">SpawnProps</span><span class="params">(<span class="type">const</span> FTransform&amp; SpawnTransform)</span></span>;</span><br></pre></td></tr></table></figure>
<p>相关问题：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://answers.unrealengine.com/questions/50892/shipping-formal-parameter-with-declspecalign16-won.html">Shipping: formal parameter with declspec(align(‘16’)) won’t be aligned</a></li>
<li><a target="_blank" rel="noopener" href="https://answers.unrealengine.com/questions/362434/fvector4-error-not-usable-with-x32-game-package.html">FVector4 error not usable with x32 game package</a></li>
</ul>
<h3 id="UE打包时提示文件占用导致打包失败"><a href="#UE打包时提示文件占用导致打包失败" class="headerlink" title="UE打包时提示文件占用导致打包失败"></a>UE打包时提示文件占用导致打包失败</h3><ul>
<li>引擎版本：4.18.3</li>
<li>打包平台：Windows</li>
<li>运行模式：VR</li>
<li>BuildConfiguration: Shipping</li>
</ul>
<p>打包中的错误信息log：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UATHelper: Packaging (Windows (64-bit)): Program.Main: ERROR: AutomationTool terminated with exception: System.IO.IOException: The process cannot access the file** ‘C:\YourProjectPath\Saved\StagedBuilds\WindowsNoEditor\Engine\Extras\Redist\en-us\UE4PrereqSetup_x64.exe’ **because it is being used by another process**.</span><br></pre></td></tr></table></figure>
<p>UE打包时的错误提示为<strong>is being used by another process</strong>的原因是进程里也启动了EpicGameLauncher，打包之前把它关掉就可以了。</p>
<h2 id="Online"><a href="#Online" class="headerlink" title="Online"></a>Online</h2><hr>
<h3 id="UE-Actor-Replication-Config"><a href="#UE-Actor-Replication-Config" class="headerlink" title="UE Actor Replication Config"></a>UE Actor Replication Config</h3><h3 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h3><p>OnlyRelecantToServer(default false)<br>if true,this actor is only relevant its owner,if this flag is changed during play,all non-owner channels would need to be explicitly close.</p>
<h3 id="Always-Relevant-default-false"><a href="#Always-Relevant-default-false" class="headerlink" title="Always Relevant(default false)"></a>Always Relevant(default false)</h3><p>Always relevant for network(overrides bOnlyRelevantToOwner)</p>
<h3 id="ReplicateMovement-default-true"><a href="#ReplicateMovement-default-true" class="headerlink" title="ReplicateMovement(default true)"></a>ReplicateMovement(default true)</h3><p>if true,replicate movement/location related properties.<br>Actor must also be set to replicate.</p>
<ol>
<li>see SetReplicates()</li>
<li>see <a target="_blank" rel="noopener" href="https://doc.unrealengine.com/latest/INT/Gameplay/Networking/Replication/">https://doc.unrealengine.com/latest/INT/Gameplay/Networking/Replication/</a></li>
</ol>
<h3 id="NetLoadOnClient-default-true"><a href="#NetLoadOnClient-default-true" class="headerlink" title="NetLoadOnClient(default true)"></a>NetLoadOnClient(default true)</h3><p>This actor will be loaded on network clients during map load.</p>
<h3 id="NetUseOwnerReplovancy-default-false"><a href="#NetUseOwnerReplovancy-default-false" class="headerlink" title="NetUseOwnerReplovancy(default false)"></a>NetUseOwnerReplovancy(default false)</h3><p>If actor has valid Owner, call Owner’s IsNetRelevantFor and GetNetPriovity</p>
<h3 id="Replicates-default-true"><a href="#Replicates-default-true" class="headerlink" title="Replicates(default true)"></a>Replicates(default true)</h3><p>if true,this actor will replicate to remote machines<br>see SetReplicates()</p>
<h3 id="NetDormancy-default-DORM-Awake"><a href="#NetDormancy-default-DORM-Awake" class="headerlink" title="NetDormancy(default DORM_Awake)"></a>NetDormancy(default DORM_Awake)</h3><p>Dormancy setting for actor ro take itself off the replication list without being destory on clients.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This actor can go dormant,but is not currently dormant,Game code will tell it when it go dormant.</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ENetDormancy</span></span><br><span class="line">&#123;</span><br><span class="line">    DORM_Never,</span><br><span class="line">    DORM_Awake,</span><br><span class="line">    DORM_DormantAll,</span><br><span class="line">    DORM_DormantPartial,</span><br><span class="line">    DORM_Initial,</span><br><span class="line">    DORM_MAX,</span><br><span class="line">&#125;</span><br><span class="line">DORM_Never: This actor can never go network dormant.</span><br><span class="line">DORM_Awake: This actor can go dormant, but is <span class="keyword">not</span> currently dormant. Game code will tell it when it go dormant.</span><br><span class="line">DORM_DormantAll: This actor wants to go fully dormant <span class="keyword">for</span> all connections.</span><br><span class="line">DORM_DormantPartial: This actor may want to go dormant <span class="keyword">for</span> some connections, <span class="built_in">GetNetDormancy</span>() will be called to find out which.</span><br><span class="line">DORM_Initial: This actor is initially dormant <span class="keyword">for</span> all connection <span class="keyword">if</span> it was placed in map.</span><br><span class="line">DORM_MAX</span><br></pre></td></tr></table></figure>

<h3 id="NeuCullDistanceSquared-default-225000000-0"><a href="#NeuCullDistanceSquared-default-225000000-0" class="headerlink" title="NeuCullDistanceSquared(default 225000000.0)"></a>NeuCullDistanceSquared(default 225000000.0)</h3><p>Suqare of the max distance from the client’s viewpoint that this actor is relevant and will be replicated.</p>
<h3 id="NetUpdateFrequency-default-100-0"><a href="#NetUpdateFrequency-default-100-0" class="headerlink" title="NetUpdateFrequency(default 100.0)"></a>NetUpdateFrequency(default 100.0)</h3><p>how often(per second) this actor will be considered for replication,used to determine NetUpdateTime.</p>
<h3 id="MinNetUpdateFrequency-default-2-0"><a href="#MinNetUpdateFrequency-default-2-0" class="headerlink" title="MinNetUpdateFrequency(default 2.0)"></a>MinNetUpdateFrequency(default 2.0)</h3><p>Used to determine what rate to throttle down to when replicated properties are changing infrequently.</p>
<h3 id="NetPriority-default-3-0"><a href="#NetPriority-default-3-0" class="headerlink" title="NetPriority: (default 3.0)"></a>NetPriority: (default 3.0)</h3><p>Priority for this actor when checking for replication in a low bandwidth or saturated siuation,higher priority means it is more likely to replicate.</p>
<h3 id="Replicated-Movement"><a href="#Replicated-Movement" class="headerlink" title="Replicated Movement"></a>Replicated Movement</h3><p>LocationQuantization Level: (default EVectorQuantization::RoundTwoDecimals)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">EVectorQuantization</span></span><br><span class="line">&#123;</span><br><span class="line">    RoundWholeNumber,</span><br><span class="line">    RoundOneDecimal,</span><br><span class="line">    RoundTwoDecimals,</span><br><span class="line">&#125;</span><br><span class="line">RoundWholeNumber: Each vector component will be rounded to the nearest whole number.</span><br><span class="line">RoundOneDecimal: Each vector component will be rounded, preserving one decimal place.</span><br><span class="line">RoundTwoDecimals: Each vector component will be rounded, preserving two decimal places.</span><br></pre></td></tr></table></figure>

<p>VelocityQuantization Level: (default ERotatorQuantization::RoundWholeNumber)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ERotatorQuantization</span></span><br><span class="line">&#123;</span><br><span class="line">    ByteComponents,</span><br><span class="line">    ShortComponents,</span><br><span class="line">&#125;</span><br><span class="line">ByteComponents: The rotator will be compressed to <span class="number">8</span> bits per component.</span><br><span class="line">ShortComponents: The rotator will be compressed to <span class="number">16</span> bits per component.</span><br></pre></td></tr></table></figure>

<h3 id="RotationQuantization-Level-default-ByteComponents"><a href="#RotationQuantization-Level-default-ByteComponents" class="headerlink" title="RotationQuantization Level(default ByteComponents)"></a>RotationQuantization Level(default ByteComponents)</h3><p>Allow turing the compression level for replicated rotation.You should only need to change this from the default if you see visual artfacts.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ERotatorQuantization</span></span><br><span class="line">&#123;</span><br><span class="line">    ByteComponents,</span><br><span class="line">    ShortComponents,</span><br><span class="line">&#125;</span><br><span class="line">ByteComponents: The rotator will be compressed to <span class="number">8</span> bits per component.</span><br><span class="line">ShortComponents: The rotator will be compressed to <span class="number">16</span> bits per component.</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="UE编辑器内测试多人时禁用自动连接"><a href="#UE编辑器内测试多人时禁用自动连接" class="headerlink" title="UE编辑器内测试多人时禁用自动连接"></a>UE编辑器内测试多人时禁用自动连接</h3><p><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-Editor-Play-Options.webp"><br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/UE-Editor-Mulitplayer-AutoConnectToServer.webp"></p>
<h3 id="使用UE联网的部分问题"><a href="#使用UE联网的部分问题" class="headerlink" title="使用UE联网的部分问题"></a>使用UE联网的部分问题</h3><p>UE里提供了<code>AController::IsLocalControlled</code>来判断当前控制器控制的是否是本地实体：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">AController::IsLocalController</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> ENetMode NetMode = <span class="built_in">GetNetMode</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (NetMode == NM_Standalone)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Not networked.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (NetMode == NM_Client &amp;&amp; Role == ROLE_AutonomousProxy)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Networked client in control.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">GetRemoteRole</span>() != ROLE_AutonomousProxy &amp;&amp; Role == ROLE_Authority)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Local authority in control.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：千万谨慎不要在Pawn里使用<code>AutoPossessPlayer</code>选项。这会使加入进来的玩家的Controller自动作为Player0，造成奇葩的bug.</p>
</blockquote>
<p>还有<code>UKismetSystemLibrary::IsServer</code>/<code>UKismetSystemLibrary::IsDedicatedServer</code>,他们获取的都是当前<code>World</code>的<code>GetNetMode</code>来判断的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UKismetSystemLibrary::IsServer</span><span class="params">(UObject* WorldContextObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  UWorld* World = GEngine-&gt;<span class="built_in">GetWorldFromContextObject</span>(WorldContextObject, EGetWorldErrorMode::LogAndReturnNull);</span><br><span class="line">  <span class="keyword">return</span> World ? (World-&gt;<span class="built_in">GetNetMode</span>() != NM_Client) : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UKismetSystemLibrary::IsDedicatedServer</span><span class="params">(UObject* WorldContextObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  UWorld* World = GEngine-&gt;<span class="built_in">GetWorldFromContextObject</span>(WorldContextObject, EGetWorldErrorMode::LogAndReturnNull);</span><br><span class="line">  <span class="keyword">if</span> (World)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> (World-&gt;<span class="built_in">GetNetMode</span>() == NM_DedicatedServer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">IsRunningDedicatedServer</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UKismetSystemLibrary::IsStandalone</span><span class="params">(UObject* WorldContextObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  UWorld* World = GEngine-&gt;<span class="built_in">GetWorldFromContextObject</span>(WorldContextObject, EGetWorldErrorMode::LogAndReturnNull);</span><br><span class="line">  <span class="keyword">return</span> World ? (World-&gt;<span class="built_in">GetNetMode</span>() == NM_Standalone) : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>enum ENetMode</code>的成员及其含义如下：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Descript</th>
</tr>
</thead>
<tbody><tr>
<td>NM_Standalone</td>
<td>Standalone: a game without networking, with one or more local players.</td>
</tr>
<tr>
<td>NM_DedicatedServer</td>
<td>Dedicated server: server with no local players.</td>
</tr>
<tr>
<td>NM_ListenServer</td>
<td>Listen server: a server that also has a local player who is hosting the game, available to other players on the network.</td>
</tr>
<tr>
<td>NM_Client</td>
<td>Network client: client connected to a remote server.</td>
</tr>
<tr>
<td>NM_MAX</td>
<td></td>
</tr>
</tbody></table>
<h3 id="使用UE的OnlineSubsystem联网"><a href="#使用UE的OnlineSubsystem联网" class="headerlink" title="使用UE的OnlineSubsystem联网"></a>使用UE的OnlineSubsystem联网</h3><p>UE的联网可以通过<code>CreateSession</code>/<code>FindSeccsion</code>/<code>JoinSession</code>来实现，但要先进行一些简单配置。<br>编辑<code>Config\DefaultEngine.ini</code>,加入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+NetDriverDefinitions=(DefName=&quot;GameNetDriver&quot;,DriverClassName=&quot;/Script/OnlineSubsystemSteam.SteamNetDriver&quot;,DriverClassNameFallback=&quot;/Script/OnlineSubsystemUtils.IpNetDriver&quot;)</span><br><span class="line"></span><br><span class="line">[OnlineSubsystem]</span><br><span class="line">DefaultPlatformService=Null</span><br></pre></td></tr></table></figure>
<p>注意和对接Steam的不同，要把<code>DefaultPlatformService</code>改为<code>Null</code>，不然无法加入Session.</p>
<h3 id="UE联网客户端没有寻路"><a href="#UE联网客户端没有寻路" class="headerlink" title="UE联网客户端没有寻路"></a>UE联网客户端没有寻路</h3><p>需要在<code>Project Settings</code>-<code>NavigationSystem</code>里设置<code>Allow Client Side Navigation</code>为<code>true</code>：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/ue4-client-not-generate-navigation.webp"></p>
<h3 id="UE的Session在LAN中搜索不到"><a href="#UE的Session在LAN中搜索不到" class="headerlink" title="UE的Session在LAN中搜索不到"></a>UE的Session在LAN中搜索不到</h3><p>使用UE的<code>CreateSession</code>创建，然后在LAN的另一台机器上使用<code>FindSession</code>无法找到Session列表。<br>出现这个问题的原因是电脑上装了VM或者VirtualBox之类的虚拟机，需要把<code>VMware Network Adapter</code>或者<code>VirtualBox NetWork Adapter</code>禁用掉就可以了。<br>在控制面板的具体位置为<code>控制面板/网络和Internet/网络和共享中心/更改适配器设置</code>：<br><img data-src="https://img.imzlp.com/imgs/zlp/blog/posts/3380/fixd-UE-session-cant-search-in-LAN.webp"></p>
<h2 id="Other-Script"><a href="#Other-Script" class="headerlink" title="Other Script"></a>Other Script</h2><h3 id="UE莫名其妙的编译和链接错误"><a href="#UE莫名其妙的编译和链接错误" class="headerlink" title="UE莫名其妙的编译和链接错误"></a>UE莫名其妙的编译和链接错误</h3><p>修改代码后最好把下面的文件删了:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Binaries</span><br><span class="line">Debug</span><br><span class="line">Intermediate</span><br><span class="line">Saved(注意打包缓存可以不清理)</span><br><span class="line">*.VC.db</span><br></pre></td></tr></table></figure>
<p>bat脚本如下：</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">del</span> *.VC.db</span><br><span class="line"><span class="built_in">rd</span> /s /q Binaries</span><br><span class="line"><span class="built_in">rd</span> /s /q Debug</span><br><span class="line"><span class="built_in">rd</span> /s /q Intermediate</span><br><span class="line"><span class="built_in">rd</span> /s /q Saved</span><br></pre></td></tr></table></figure>
<p>还有搜索所有插件目录的Binaries和Intermediate：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find . -name <span class="string">&quot;Binaries&quot;</span>|xargs <span class="built_in">rm</span> -rf</span><br><span class="line">$ find . -name <span class="string">&quot;Intermediate&quot;</span>|xargs <span class="built_in">rm</span> -rf</span><br></pre></td></tr></table></figure>

<h2 id="Profiling-Commands"><a href="#Profiling-Commands" class="headerlink" title="Profiling Commands"></a>Profiling Commands</h2><p><strong>显示FPS</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> FPS</span><br></pre></td></tr></table></figure>
<p><strong>显示统计单元</strong>(每帧的总时间，逻辑线程/渲染线程和GPU的时间消耗)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> Unit</span><br></pre></td></tr></table></figure>
<p><strong>显示渲染线程中的各种参数值</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stat SceneRendering</span><br></pre></td></tr></table></figure>

<p><strong>显示渲染线程命令的消耗</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> RenderThreadCommands</span><br></pre></td></tr></table></figure>

<p><strong>显示游戏线程上的参数</strong>(AI/物理/动画/蓝图/内存分配等)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> game</span><br></pre></td></tr></table></figure>

<p><strong>显示剔除所需的时间和效率数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stat InitViews</span><br></pre></td></tr></table></figure>

<p><strong>显示照明和着色所需的渲染时间</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stat LightRendering</span><br></pre></td></tr></table></figure>

<p><strong>抓取当前帧的GPU信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProfileGPU</span><br></pre></td></tr></table></figure>
<p>会弹出<code>GPU Data Bisualizer</code>的<code>GPU Visualizer</code>显示抓取帧的数据。</p>
<p><strong>抓取Profiling信息(CPU/GPU)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> StartFile</span><br><span class="line"><span class="built_in">stat</span> StopFile</span><br></pre></td></tr></table></figure>
<p>会在项目的<code>Saved/Profiling/UnrealStats</code>下产生<code>*.ue4stats</code>文件，可以使用UnrealFornted打开。</p>
<p><strong>UE网络分析</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开和关闭录制</span></span><br><span class="line">netprofile</span><br><span class="line"><span class="comment"># 如果尚未录制则开始录制</span></span><br><span class="line">netprofile <span class="built_in">enable</span></span><br><span class="line"><span class="comment"># 如果当前正在录制，则停止录制</span></span><br><span class="line">netprofile <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>
<p>捕获的数据保存在<code>Saved/Profiling</code>下，后缀名为<code>*.nprof</code>。<br>UE网络分析(Network Profiler)工具的文档<a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Gameplay/Tools/NetworkProfiler">Network Profiler</a>.</p>
<p>链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Engine/Performance">Performance and Profiling</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Engine/Performance/GPU">GPU Profiling</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Engine/Performance/StatCommands">Stat Commands</a></li>
<li><a target="_blank" rel="noopener" href="https://software.intel.com/en-us/articles/vr-developer-tutorial-testing-and-profiling-the-premium-vr-game">VR Developer Tutorial: Testing and Profiling the Premium VR Game</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-us/Gameplay/Tools/NetworkProfiler">Network Profiler</a></li>
</ul>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                全文完，若有不足之处请评论指正。
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>微信扫描二维码，关注我的公众号。</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>本文标题:</span><a href="/posts/3380/" target="_blank">UE和VR开发技术笔记</a><br/>
             <span>文章作者:</span><a href="/about" target="_blank" title="查看 查利鹏 的资料">查利鹏</a><br/>
             <span>发布时间:</span>2018年06月06日 08时16分<br/>
             
              <span>更新时间:</span>2019年01月17日 14时00分<br/>
             
             <span>本文字数:</span><span class="page-count">本文一共有16k字</span><br/>
             
             <span>原始链接:</span><a href="/posts/3380/" target="_blank" title="UE和VR开发技术笔记">https://imzlp.com/posts/3380/</a>
             <span class="copy-path" data-clipboard-text="原文链接: https://imzlp.com/posts/3380/ 作者: 查利鹏" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>许可协议:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>文章禁止全文转载，摘要转发请保留原文链接及作者信息，谢谢！</span>
          </div>
        
    
        
  <div class="reward-container">
    <div>您的捐赠将鼓励我继续创作！</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      打赏
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="查利鹏 微信支付">
          <p>微信支付</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/UnrealEngine/" rel="tag"># UnrealEngine</a>
              <a href="/tags/VR/" rel="tag"># VR</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/5050/" rel="prev" title="使用frp进行内网穿透">
      <i class="fa fa-chevron-left"></i> 使用frp进行内网穿透
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/19376/" rel="next" title="UE无缝地图：传递Actor到下个关卡">
      UE无缝地图：传递Actor到下个关卡 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Engine-Documents"><span class="nav-number">1.</span> <span class="nav-text">Engine Documents</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UE4-Online-Documents"><span class="nav-number">1.1.</span> <span class="nav-text">UE4 Online Documents</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-GamePlay-Framework-Tutorial"><span class="nav-number">1.2.</span> <span class="nav-text">UE GamePlay Framework Tutorial</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VR-Devices"><span class="nav-number">2.</span> <span class="nav-text">VR Devices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E9%80%82%E9%85%8D%E4%B8%8D%E5%90%8CVR%E8%AE%BE%E5%A4%87%E7%9A%84%E9%AB%98%E5%BA%A6%E9%97%AE%E9%A2%98"><span class="nav-number">2.1.</span> <span class="nav-text">UE适配不同VR设备的高度问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E4%B8%AD%E6%B8%B8%E6%88%8F%E5%90%AF%E5%8A%A8VR%E5%A4%B4%E6%98%BE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">UE中游戏启动VR头显初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E7%BD%AEVR%E5%A4%B4%E6%98%BE%E6%97%8B%E8%BD%AC%E5%92%8C%E4%BD%8D%E7%BD%AE"><span class="nav-number">2.3.</span> <span class="nav-text">重置VR头显旋转和位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8Oculus-Rift"><span class="nav-number">2.4.</span> <span class="nav-text">在UE中使用Oculus Rift</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTC-Vive%E7%9A%84%E6%8C%89%E9%94%AE%E6%98%A0%E5%B0%84"><span class="nav-number">2.5.</span> <span class="nav-text">HTC Vive的按键映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTC-VIVE%E8%AE%BE%E5%A4%87%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.6.</span> <span class="nav-text">HTC VIVE设备设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SteamVR-2-0%E5%AE%9A%E4%BD%8D%E5%9F%BA%E7%AB%99"><span class="nav-number">2.7.</span> <span class="nav-text">SteamVR 2.0定位基站</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Proxifier%E8%AE%A9Oculus%E8%B5%B0SS%E4%BB%A3%E7%90%86"><span class="nav-number">2.8.</span> <span class="nav-text">使用Proxifier让Oculus走SS代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VR%E7%94%BB%E9%9D%A2%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">2.9.</span> <span class="nav-text">VR画面模糊的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTC-VIVE%E5%AE%9A%E4%BD%8D%E5%99%A8%E6%95%85%E9%9A%9C-03-%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-number">2.10.</span> <span class="nav-text">HTC VIVE定位器故障(03)的解决办法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Engine-Analysis"><span class="nav-number">3.</span> <span class="nav-text">Engine Analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-Game%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="nav-number">3.1.</span> <span class="nav-text">UE Game的启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E4%B8%ADActor%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">3.2.</span> <span class="nav-text">UE中Actor初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE4-Engine-Start-Order"><span class="nav-number">3.3.</span> <span class="nav-text">UE4:Engine Start Order</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E5%BC%95%E6%93%8E%E7%9A%84Tick%E8%B0%83%E7%94%A8%E6%A0%88-call-stack"><span class="nav-number">3.4.</span> <span class="nav-text">UE引擎的Tick调用栈(call stack)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Game-Flow-on-UE4"><span class="nav-number">3.5.</span> <span class="nav-text">Game Flow on UE4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Actor-LifeCycle"><span class="nav-number">3.6.</span> <span class="nav-text">Actor LifeCycle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-Log-macro-defined"><span class="nav-number">3.7.</span> <span class="nav-text">UE Log macro defined</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E4%B8%BA%E5%AE%89%E8%A3%85%E7%89%88%E5%BC%95%E6%93%8E%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">3.8.</span> <span class="nav-text">检测是否为安装版引擎的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-Get-all-registed-Engine"><span class="nav-number">3.9.</span> <span class="nav-text">UE:Get all registed Engine</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UnrealVersionSelector%E6%B3%A8%E5%86%8C%E5%BC%95%E6%93%8E%E8%B7%AF%E5%BE%84"><span class="nav-number">3.10.</span> <span class="nav-text">UnrealVersionSelector注册引擎路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EpicGameLauncher%E7%89%88%E5%BC%95%E6%93%8E%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%B7%AF%E5%BE%84"><span class="nav-number">3.11.</span> <span class="nav-text">EpicGameLauncher版引擎注册表路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UnrealVersionSelector%E7%9A%84%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%96%87%E4%BB%B6%E5%85%B3%E8%81%94"><span class="nav-number">3.12.</span> <span class="nav-text">UnrealVersionSelector的注册表文件关联</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E6%B3%A8%E5%86%8C%E7%BC%96%E8%AF%91%E7%89%88%E5%BC%95%E6%93%8E%E7%9A%84%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84"><span class="nav-number">3.13.</span> <span class="nav-text">UE注册编译版引擎的安装路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-uproject%E5%8F%B3%E9%94%AE%E7%94%9F%E6%88%90%E5%A4%B1%E8%B4%A5"><span class="nav-number">3.14.</span> <span class="nav-text">解决.uproject右键生成失败</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GamePlay"><span class="nav-number">4.</span> <span class="nav-text">GamePlay</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E5%AE%8F%E5%BA%93%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">4.1.</span> <span class="nav-text">UE宏库的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E4%BD%BF%E7%94%A8Shipping%E6%A8%A1%E5%BC%8F%E6%89%93%E5%8C%85%E7%9A%84Saved%E7%9B%AE%E5%BD%95"><span class="nav-number">4.2.</span> <span class="nav-text">UE使用Shipping模式打包的Saved目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CharacterMovement%E5%BC%80%E5%90%AFRVO%E9%81%BF%E9%9A%9C"><span class="nav-number">4.3.</span> <span class="nav-text">CharacterMovement开启RVO避障</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VR%E5%BC%93%E7%9A%84%E6%A8%A1%E5%9E%8B%E6%A0%87%E5%87%86"><span class="nav-number">4.4.</span> <span class="nav-text">VR弓的模型标准</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E6%8D%A2%E8%A3%85%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.5.</span> <span class="nav-text">UE换装的一个实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E8%93%9D%E5%9B%BE%E7%BC%96%E8%AF%91%E5%88%B0C-%E4%BB%A3%E7%A0%81"><span class="nav-number">4.6.</span> <span class="nav-text">从蓝图编译到C++代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E8%93%9D%E5%9B%BE%E5%87%BD%E6%95%B0%E5%BA%93%E6%97%A0%E6%B3%95%E5%9C%A8UObject%E5%AF%B9%E8%B1%A1%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="nav-number">4.7.</span> <span class="nav-text">UE蓝图函数库无法在UObject对象中调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E4%B8%AD%E6%94%BE%E7%BD%AE%E7%BB%84%E4%BB%B6%E5%88%B0%E9%AA%A8%E9%AA%BC%E6%8F%92%E6%A7%BD-socket"><span class="nav-number">4.8.</span> <span class="nav-text">UE中放置组件到骨骼插槽(socket)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unreal%E4%B8%AD%E8%8E%B7%E5%8F%96OpenLevel%E7%9A%84Options"><span class="nav-number">4.9.</span> <span class="nav-text">Unreal中获取OpenLevel的Options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E6%B8%B8%E6%88%8F%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%843D%E4%BD%8D%E7%BD%AE%E5%88%B0%E5%B1%8F%E5%B9%95%E4%BD%8D%E7%BD%AE"><span class="nav-number">4.10.</span> <span class="nav-text">转换游戏场景中的3D位置到屏幕位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E9%BC%A0%E6%A0%87%E7%9A%84%E5%85%89%E6%A0%87%E5%9C%A8viewport%E5%86%85%E7%9A%84%E7%9B%B8%E5%AF%B9%E4%BD%8D%E7%BD%AE"><span class="nav-number">4.11.</span> <span class="nav-text">设置鼠标的光标在viewport内的相对位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E5%90%AF%E5%8A%A8%E6%B8%B8%E6%88%8F%E5%90%8E%E9%BC%A0%E6%A0%87%E7%84%A6%E7%82%B9%E4%B8%8D%E5%9C%A8%E7%AA%97%E5%8F%A3%E5%86%85"><span class="nav-number">4.12.</span> <span class="nav-text">UE启动游戏后鼠标焦点不在窗口内</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E7%89%B9%E6%95%88%E6%98%AF%E5%90%A6%E5%BE%AA%E7%8E%AF"><span class="nav-number">4.13.</span> <span class="nav-text">判断一个特效是否循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%A8%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8%E7%B1%BB%E6%B3%A8%E6%84%8F%E6%98%AF%E5%90%A6%E5%AF%BC%E5%87%BA%E7%AC%A6%E5%8F%B7"><span class="nav-number">4.14.</span> <span class="nav-text">跨模块使用类注意是否导出符号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blueprint%E5%88%9B%E5%BB%BA%E5%BC%82%E6%AD%A5%E8%8A%82%E7%82%B9"><span class="nav-number">4.15.</span> <span class="nav-text">Blueprint创建异步节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E5%BC%95%E7%94%A8windows%E5%A4%B4%E6%96%87%E4%BB%B6%E7%9A%84%E8%AD%A6%E5%91%8A-%E9%94%99%E8%AF%AF"><span class="nav-number">4.16.</span> <span class="nav-text">UE引用windows头文件的警告&#x2F;错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E8%8E%B7%E5%8F%96%E5%85%89%E6%A0%87%E5%9C%A8%E7%AA%97%E5%8F%A3%E7%9A%84%E7%9B%B8%E5%AF%B9%E6%AF%94%E4%BE%8B"><span class="nav-number">4.17.</span> <span class="nav-text">UE获取光标在窗口的相对比例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-SceneCapture2D%E6%8D%95%E8%8E%B7%E7%9A%84gamma%E5%80%BC"><span class="nav-number">4.18.</span> <span class="nav-text">UE SceneCapture2D捕获的gamma值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%93%9D%E5%9B%BEEvent%E5%8F%82%E6%95%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E9%AA%9A%E6%93%8D%E4%BD%9C"><span class="nav-number">4.19.</span> <span class="nav-text">蓝图Event参数的一个骚操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E4%BD%BF%E7%94%A8UProjectileMovementComponent%E7%9A%84%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B%E9%97%AE%E9%A2%98"><span class="nav-number">4.20.</span> <span class="nav-text">UE使用UProjectileMovementComponent的碰撞检测问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Config-and-Editor"><span class="nav-number">5.</span> <span class="nav-text">Config and Editor</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9UE%E7%9A%84%E7%BC%96%E8%BE%91%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84Esc%E9%80%80%E5%87%BA%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="nav-number">5.1.</span> <span class="nav-text">修改UE的编辑器模式下的Esc退出快捷键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E5%9C%A8%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%AD%E6%98%BE%E7%A4%BA%E6%8F%92%E4%BB%B6%E7%9A%84Content"><span class="nav-number">5.2.</span> <span class="nav-text">UE在编辑器中显示插件的Content</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9UE%E7%BC%96%E8%AF%91%E6%97%B6%E7%9A%84parallel%E6%95%B0%E9%87%8F"><span class="nav-number">5.3.</span> <span class="nav-text">修改UE编译时的parallel数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-Android%E6%89%93%E5%8C%85%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AD%98%E6%94%BE%E5%9C%A8obb%E6%96%87%E4%BB%B6%E4%B8%AD"><span class="nav-number">5.4.</span> <span class="nav-text">UE Android打包将数据存放在obb文件中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E7%BC%96%E8%BE%91%E5%99%A8%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%84%A6%E7%82%B9%E4%B8%8D%E5%9C%A8%E7%AA%97%E5%8F%A3%E5%86%85%E7%9A%84%E5%8D%A1%E9%A1%BF"><span class="nav-number">5.5.</span> <span class="nav-text">UE编辑器模式下焦点不在窗口内的卡顿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Win10%E4%B8%8B%E8%A7%A3%E5%86%B3UE%E7%BC%96%E8%BE%91%E5%99%A8%E5%86%85%E7%BC%96%E8%AF%91%E6%97%A5%E5%BF%97%E7%9A%84%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81"><span class="nav-number">5.6.</span> <span class="nav-text">Win10下解决UE编辑器内编译日志的中文乱码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Package"><span class="nav-number">6.</span> <span class="nav-text">Package</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ObservedKeyNames-Num-gt-0"><span class="nav-number">6.1.</span> <span class="nav-text">ObservedKeyNames.Num()&gt;0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-Package-Error-RenderDocPlugin"><span class="nav-number">6.2.</span> <span class="nav-text">UE Package Error:RenderDocPlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE4%E6%89%93%E5%8C%8532bit%E8%A6%81%E6%B1%8216byte%E5%AF%B9%E9%BD%90%E9%94%99%E8%AF%AF"><span class="nav-number">6.3.</span> <span class="nav-text">UE4打包32bit要求16byte对齐错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E6%89%93%E5%8C%85%E6%97%B6%E6%8F%90%E7%A4%BA%E6%96%87%E4%BB%B6%E5%8D%A0%E7%94%A8%E5%AF%BC%E8%87%B4%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5"><span class="nav-number">6.4.</span> <span class="nav-text">UE打包时提示文件占用导致打包失败</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Online"><span class="nav-number">7.</span> <span class="nav-text">Online</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UE-Actor-Replication-Config"><span class="nav-number">7.1.</span> <span class="nav-text">UE Actor Replication Config</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Replication"><span class="nav-number">7.2.</span> <span class="nav-text">Replication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Always-Relevant-default-false"><span class="nav-number">7.3.</span> <span class="nav-text">Always Relevant(default false)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ReplicateMovement-default-true"><span class="nav-number">7.4.</span> <span class="nav-text">ReplicateMovement(default true)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NetLoadOnClient-default-true"><span class="nav-number">7.5.</span> <span class="nav-text">NetLoadOnClient(default true)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NetUseOwnerReplovancy-default-false"><span class="nav-number">7.6.</span> <span class="nav-text">NetUseOwnerReplovancy(default false)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Replicates-default-true"><span class="nav-number">7.7.</span> <span class="nav-text">Replicates(default true)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NetDormancy-default-DORM-Awake"><span class="nav-number">7.8.</span> <span class="nav-text">NetDormancy(default DORM_Awake)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NeuCullDistanceSquared-default-225000000-0"><span class="nav-number">7.9.</span> <span class="nav-text">NeuCullDistanceSquared(default 225000000.0)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NetUpdateFrequency-default-100-0"><span class="nav-number">7.10.</span> <span class="nav-text">NetUpdateFrequency(default 100.0)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MinNetUpdateFrequency-default-2-0"><span class="nav-number">7.11.</span> <span class="nav-text">MinNetUpdateFrequency(default 2.0)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NetPriority-default-3-0"><span class="nav-number">7.12.</span> <span class="nav-text">NetPriority: (default 3.0)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Replicated-Movement"><span class="nav-number">7.13.</span> <span class="nav-text">Replicated Movement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RotationQuantization-Level-default-ByteComponents"><span class="nav-number">7.14.</span> <span class="nav-text">RotationQuantization Level(default ByteComponents)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E7%BC%96%E8%BE%91%E5%99%A8%E5%86%85%E6%B5%8B%E8%AF%95%E5%A4%9A%E4%BA%BA%E6%97%B6%E7%A6%81%E7%94%A8%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.15.</span> <span class="nav-text">UE编辑器内测试多人时禁用自动连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8UE%E8%81%94%E7%BD%91%E7%9A%84%E9%83%A8%E5%88%86%E9%97%AE%E9%A2%98"><span class="nav-number">7.16.</span> <span class="nav-text">使用UE联网的部分问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8UE%E7%9A%84OnlineSubsystem%E8%81%94%E7%BD%91"><span class="nav-number">7.17.</span> <span class="nav-text">使用UE的OnlineSubsystem联网</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E8%81%94%E7%BD%91%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B2%A1%E6%9C%89%E5%AF%BB%E8%B7%AF"><span class="nav-number">7.18.</span> <span class="nav-text">UE联网客户端没有寻路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E7%9A%84Session%E5%9C%A8LAN%E4%B8%AD%E6%90%9C%E7%B4%A2%E4%B8%8D%E5%88%B0"><span class="nav-number">7.19.</span> <span class="nav-text">UE的Session在LAN中搜索不到</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-Script"><span class="nav-number">8.</span> <span class="nav-text">Other Script</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UE%E8%8E%AB%E5%90%8D%E5%85%B6%E5%A6%99%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF"><span class="nav-number">8.1.</span> <span class="nav-text">UE莫名其妙的编译和链接错误</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Profiling-Commands"><span class="nav-number">9.</span> <span class="nav-text">Profiling Commands</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person" oncontextmenu="return false" οndragstart="return false">
    <img class="site-author-image" itemprop="image" alt="查利鹏"
      src="https://img.imzlp.com/imgs/zlp/picgo/2023/202304152112902.webp">
  <p class="site-author-name" itemprop="name">查利鹏</p>
  <div class="site-description" itemprop="description">唯有热爱可抵岁月漫长。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
             
          <span class="site-state-item-count">189</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">94</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">188</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://linkedin.com/in/lipengzha" title="Linkedin → https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;lipengzha" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imzlp@foxmail.com" title="E-Mail → mailto:imzlp@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/opensource/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;opensource&#x2F;">Open Source Projects</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://imzlp.com/posts/11515/" title="https:&#x2F;&#x2F;imzlp.com&#x2F;posts&#x2F;11515&#x2F;">UE C++ API Dash Documents</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5wiki.com/" title="https:&#x2F;&#x2F;ue5wiki.com&#x2F;" rel="noopener" target="_blank">Unreal Engine Wiki</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021027036号 </a>
      <img src="/images/beian_logo.webp" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030502007298" rel="noopener" target="_blank">粤公网安备44030502007298号 </a>
  </div>

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">查利鹏</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">747k</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animejs/3.2.1/anime.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.5.1/jquery.min.js"></script>
  <script src="//lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>



<script src="/js/code-unfold.js"></script>

  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//img.imzlp.com/imgs/zlp/picgo/2021/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://imzlp.com/posts/3380/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.14/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    var requiredFields = 'nick';
    requiredFields = requiredFields.split(',');
    
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "留下点什么吧~",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : '',
      requiredFields: requiredFields
    });
  }, window.Valine);
});
</script>

</body>
</html>
